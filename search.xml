<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>2025最新STM32G4DFU升级实现与各种坑</title>
    <url>/2025/03/17/2025%E6%9C%80%E6%96%B0STM32G4DFU%E5%8D%87%E7%BA%A7%E5%AE%9E%E7%8E%B0%E4%B8%8E%E5%90%84%E7%A7%8D%E5%9D%91/</url>
    <content><![CDATA[<p>因为项目开发需要，鼓捣一下stm32的usb dfu固件升级，搜了下网上教程，很多讲的很详细也很好，但是都比较老了，用的F4一类的比较老的型号和库，ST的HAL库又没事就改实现和接口，于是照着做下来发现坑深似海，遇到了一堆问题。</p>
<p>姑且记录一下实现的方法和遇到的各种坑点吧，仅供参考。</p>
<span id="more"></span>
<p>首先大家知道stm32的新型号一般是内置dfu bootloader的，通过一些boot引脚配置是可以上电引导到内置的dfu bl然后通过usb用cube programmer去下载。但是这种做法不太灵活，必须关机上电拉引脚才能实现升级，所以还是自己实现一个dfu固件，这样可以自由的通过软件代码切换如何进入dfu模式进行下载，实现诸如在线ota推送固件之类的功能。</p>
<p>然后现在st的cube programmer也是可以直接支持自己实现的dfu固件的下载烧录的，所以一些老教程里面说的efuse之类的工具都可以不要用了，这玩意st官方页面已经说明停止更新了，听说bug也挺多的。</p>
<p>那么我们开始。</p>
<h2 id="flash空间和地址分配"><a href="#flash空间和地址分配" class="headerlink" title="flash空间和地址分配"></a>flash空间和地址分配</h2><p>用的芯片是STM32G431CBT6，产品页可以看到flash大小是128k</p>
<p><img src="https://www.st.com.cn/content/ccc/fragment/product_related/line_information/line_level_diagram/group0/7f/fd/bb/1f/31/4d/43/db/obn_stm32g4x1_ln2128/files/obn_stm32g4x1_ln2128.jpg/jcr:content/translations/en.obn_stm32g4x1_ln2128.jpg" alt="img"></p>
<p>stm32的flash区地址默认是0x08000000，128k的结束地址是0x08020000</p>
<p>我们这里给dfu固件分配16k地址，差不多刚好能放下，也就是把dfu固件放在flash区起始这一块，0x08000000到0x08004000这一段空间里，上电默认就会先运行dfu固件，然后在dfu固件里面判断是否进入dfu下载模式或者直接跳转到用户app。</p>
<p>128k去掉16k剩下的用户app空间是112k，也就是0x1c000，从0x08004000到0x08020000这段空间。这些地址之后需要用到。</p>
<p>很多教程里给dfu固件分配的空间是0xc000也就是48k，是可以的但是因为我的mcu本身flash区比较小，就省着点用了。</p>
<p>下面这个图来自RM0440，STM32G4的 Reference manual</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503171209178.png" alt="image-20250317120944129"></p>
<p>也就是说默认情况下我们这片G431的128k flash是64个2k的page，一个bank，看下代码</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503171211034.png" alt="image-20250317121116005">    </p>
<p>page size这里是2k</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503171214396.png" alt="image-20250317121428350"></p>
<p>一些老教程里有这张图，这个我查了下是F4的 Reference manual里的，同样的章节G4已经没有这个了，也搜不到sector相关的描述了，包括老教程里的一些sector擦除写入之类的函数接口库里也都找不到了，官方给的例程只有按page擦除了。所以我们也不管这个sector相关的东西。</p>
<h2 id="DFU固件生成"><a href="#DFU固件生成" class="headerlink" title="DFU固件生成"></a>DFU固件生成</h2><p><strong>先配置cube</strong></p>
<p>先用cube创建一个空工程，配置时钟树，swd调试接口，打开你需要的IO（比如指示灯，进DFU模式的按键）</p>
<p>打开USB设备，勾上就行，默认。</p>
<p>在中间件里打开usb设备里的DFU，然后重点是下面的配置</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503171219021.png" alt="image-20250317121953974">        </p>
<p>第一行是DFU程序占用的地址，也就是用户app的起始地址，之前已经说过了，占用16k也就是改成0x08004000</p>
<p>第二行描述的是flash的内存组织方法</p>
<p>因为我们的前16k是dfu固件不应该被操作，后面112k是用户app，需要通过dfu程序在线擦写。</p>
<p>每段flash的page是2k。</p>
<p>所以修改基地址后面的内存空间描述，也就是8个2k的只读地址（Ka代表不可写）后面56个2k的可读写（Kg代表可读写）空间，一共128k</p>
<p><code>@Internal Flash   /0x08000000/08*02Ka,56*02Kg</code></p>
<p>以前的教程包括cube默认都会给你按照0116Ka，0316Kg这种写法来写，这个应该是基于之前的sector的写法，但是根据ST官方G4系列的demo板例程里面给的配置，确实是按照2k一页来组织的，实际来看也可以正常工作。</p>
<p><strong>然后生成工程，开始改代码。</strong></p>
<p>最核心的代码在usbd_dfu_flash.c里面，需要实现flash擦写等接口的代码。</p>
<p>这个文件似乎也改过名字。。以前教程的名字是找不到的=-=</p>
<p>但是内容基本是类似的</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503171228469.png" alt="image-20250317122816428"></p>
<p>里面是一些flash读写，初始化，擦除之类的函数实现，以下代码是从ST官方的demo里复制来的，直接替换里面原有的函数即可，实测验证可用。</p>
<p>在flash描述符下面加入两个宏定义</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> FLASH_DESC_STR      <span class="string">&quot;@Internal Flash   /0x08000000/08*02Ka,56*02Kg&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* USER CODE BEGIN PRIVATE_DEFINES */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FLASH_ERASE_TIME    (uint16_t)50</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FLASH_PROGRAM_TIME  (uint16_t)50</span></span><br><span class="line"><span class="comment">/* USER CODE END PRIVATE_DEFINES */</span></span><br></pre></td></tr></table></figure>
<p>加入自定义函数声明</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* USER CODE BEGIN PRIVATE_FUNCTIONS_DECLARATION */</span></span><br><span class="line"><span class="type">static</span> <span class="type">uint32_t</span> <span class="title function_">GetPage</span><span class="params">(<span class="type">uint32_t</span> Address)</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">uint32_t</span> <span class="title function_">GetBank</span><span class="params">(<span class="type">uint32_t</span> Address)</span>;</span><br><span class="line"><span class="comment">/* USER CODE END PRIVATE_FUNCTIONS_DECLARATION */</span></span><br></pre></td></tr></table></figure>
<p>注意检查下描述符是不是对的，cube似乎有个bug，有时候不会正确更新这里的描述符，需要重新生成一下。</p>
<p>从FLASH_If_Init的实现开始改，一直到文件末尾全部直接改成下面的代码</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* Private functions ---------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  Memory initialization routine.</span></span><br><span class="line"><span class="comment">  * @retval USBD_OK if operation is successful, MAL_FAIL else.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="type">uint16_t</span> <span class="title function_">FLASH_If_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line"> &#123;</span><br><span class="line">   <span class="comment">/* USER CODE BEGIN 0 */</span></span><br><span class="line">   <span class="comment">/* Unlock the internal flash */</span></span><br><span class="line">   HAL_FLASH_Unlock();</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">   <span class="comment">/* USER CODE END 0 */</span></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * @brief  De-Initializes Memory</span></span><br><span class="line"><span class="comment">   * @retval USBD_OK if operation is successful, MAL_FAIL else</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"> <span class="type">uint16_t</span> <span class="title function_">FLASH_If_DeInit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line"> &#123;</span><br><span class="line">   <span class="comment">/* USER CODE BEGIN 1 */</span></span><br><span class="line">   <span class="comment">/* Lock the internal flash */</span></span><br><span class="line">   HAL_FLASH_Lock();</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">   <span class="comment">/* USER CODE END 1 */</span></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * @brief  Erase sector.</span></span><br><span class="line"><span class="comment">   * @param  Add: Address of sector to be erased.</span></span><br><span class="line"><span class="comment">   * @retval 0 if operation is successful, MAL_FAIL else.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"> <span class="type">uint16_t</span> <span class="title function_">FLASH_If_Erase</span><span class="params">(<span class="type">uint32_t</span> Add)</span></span><br><span class="line"> &#123;</span><br><span class="line">   <span class="comment">/* USER CODE BEGIN 2 */</span></span><br><span class="line">   FLASH_EraseInitTypeDef eraseinitstruct;</span><br><span class="line">   <span class="type">uint32_t</span> PageError = <span class="number">0U</span>;</span><br><span class="line">   HAL_StatusTypeDef status;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">   <span class="comment">/* Unlock the Flash to enable the flash control register access */</span></span><br><span class="line">   HAL_FLASH_Unlock();</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/* Clear OPTVERR bit set on virgin samples */</span></span><br><span class="line">   __HAL_FLASH_CLEAR_FLAG(FLASH_FLAG_OPTVERR);</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/* Get the number of sector to erase from 1st sector */</span></span><br><span class="line">   eraseinitstruct.TypeErase = FLASH_TYPEERASE_PAGES;</span><br><span class="line">   eraseinitstruct.Banks = GetBank(Add);</span><br><span class="line">   eraseinitstruct.Page = GetPage(Add);</span><br><span class="line">   eraseinitstruct.NbPages = <span class="number">1U</span>;</span><br><span class="line">   status = HAL_FLASHEx_Erase(&amp;eraseinitstruct, &amp;PageError);</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">if</span> (status != HAL_OK)</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="number">1U</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0U</span>;</span><br><span class="line">   <span class="comment">/* USER CODE END 2 */</span></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * @brief  Memory write routine.</span></span><br><span class="line"><span class="comment">   * @param  src: Pointer to the source buffer. Address to be written to.</span></span><br><span class="line"><span class="comment">   * @param  dest: Pointer to the destination buffer.</span></span><br><span class="line"><span class="comment">   * @param  Len: Number of data to be written (in bytes).</span></span><br><span class="line"><span class="comment">   * @retval USBD_OK if operation is successful, MAL_FAIL else.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"> <span class="type">uint16_t</span> <span class="title function_">FLASH_If_Write</span><span class="params">(<span class="type">uint8_t</span> *src, <span class="type">uint8_t</span> *dest, <span class="type">uint32_t</span> Len)</span></span><br><span class="line"> &#123;</span><br><span class="line">   <span class="comment">/* USER CODE BEGIN 3 */</span></span><br><span class="line">   <span class="type">uint32_t</span> i = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/* Clear OPTVERR bit set on virgin samples */</span></span><br><span class="line">   __HAL_FLASH_CLEAR_FLAG(FLASH_FLAG_OPTVERR);</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; Len; i += <span class="number">8</span>)</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="comment">/* Device voltage range supposed to be [2.7V to 3.6V], the operation will</span></span><br><span class="line"><span class="comment">      * be done by byte */</span></span><br><span class="line">     <span class="keyword">if</span> (HAL_FLASH_Program</span><br><span class="line">         (FLASH_TYPEPROGRAM_DOUBLEWORD, (<span class="type">uint32_t</span>) (dest + i),</span><br><span class="line">          *(<span class="type">uint64_t</span> *) (src + i)) == HAL_OK)</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="comment">/* Check the written value */</span></span><br><span class="line">       <span class="keyword">if</span> (*(<span class="type">uint64_t</span> *) (src + i) != *(<span class="type">uint64_t</span> *) (dest + i))</span><br><span class="line">       &#123;</span><br><span class="line">         <span class="comment">/* Flash content doesn&#x27;t match SRAM content */</span></span><br><span class="line">         <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">else</span></span><br><span class="line">     &#123;</span><br><span class="line">       <span class="comment">/* Error occurred while writing data in Flash memory */</span></span><br><span class="line">       <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">   <span class="comment">/* USER CODE END 3 */</span></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * @brief  Memory read routine.</span></span><br><span class="line"><span class="comment">   * @param  src: Pointer to the source buffer. Address to be written to.</span></span><br><span class="line"><span class="comment">   * @param  dest: Pointer to the destination buffer.</span></span><br><span class="line"><span class="comment">   * @param  Len: Number of data to be read (in bytes).</span></span><br><span class="line"><span class="comment">   * @retval Pointer to the physical address where data should be read.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"> <span class="type">uint8_t</span> *<span class="title function_">FLASH_If_Read</span><span class="params">(<span class="type">uint8_t</span> *src, <span class="type">uint8_t</span> *dest, <span class="type">uint32_t</span> Len)</span></span><br><span class="line"> &#123;</span><br><span class="line">   <span class="comment">/* Return a valid address to avoid HardFault */</span></span><br><span class="line">   <span class="comment">/* USER CODE BEGIN 4 */</span></span><br><span class="line">   <span class="type">uint32_t</span> i = <span class="number">0</span>;</span><br><span class="line">   <span class="type">uint8_t</span> *psrc = src;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; Len; i++)</span><br><span class="line">   &#123;</span><br><span class="line">     dest[i] = *psrc++;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">/* Return a valid address to avoid HardFault */</span></span><br><span class="line">   <span class="keyword">return</span> (<span class="type">uint8_t</span> *) (dest);</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/* USER CODE END 4 */</span></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * @brief  Get status routine</span></span><br><span class="line"><span class="comment">   * @param  Add: Address to be read from</span></span><br><span class="line"><span class="comment">   * @param  Cmd: Number of data to be read (in bytes)</span></span><br><span class="line"><span class="comment">   * @param  buffer: used for returning the time necessary for a program or an erase operation</span></span><br><span class="line"><span class="comment">   * @retval USBD_OK if operation is successful</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"> <span class="type">uint16_t</span> <span class="title function_">FLASH_If_GetStatus</span><span class="params">(<span class="type">uint32_t</span> Add, <span class="type">uint8_t</span> Cmd, <span class="type">uint8_t</span> *buffer)</span></span><br><span class="line"> &#123;</span><br><span class="line">   <span class="comment">/* USER CODE BEGIN 5 */</span></span><br><span class="line">   <span class="keyword">switch</span> (Cmd)</span><br><span class="line">   &#123;</span><br><span class="line">   <span class="keyword">case</span> DFU_MEDIA_PROGRAM:</span><br><span class="line">     buffer[<span class="number">1</span>] = (<span class="type">uint8_t</span>)FLASH_PROGRAM_TIME;</span><br><span class="line">     buffer[<span class="number">2</span>] = (<span class="type">uint8_t</span>)(FLASH_PROGRAM_TIME &lt;&lt; <span class="number">8</span>);</span><br><span class="line">     buffer[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">break</span>;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">case</span> DFU_MEDIA_ERASE:</span><br><span class="line">   <span class="keyword">default</span>:</span><br><span class="line">     buffer[<span class="number">1</span>] = (<span class="type">uint8_t</span>)FLASH_ERASE_TIME;</span><br><span class="line">     buffer[<span class="number">2</span>] = (<span class="type">uint8_t</span>)(FLASH_ERASE_TIME &lt;&lt; <span class="number">8</span>);</span><br><span class="line">     buffer[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">break</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> (USBD_OK);</span><br><span class="line">   <span class="comment">/* USER CODE END 5 */</span></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">/* USER CODE BEGIN PRIVATE_FUNCTIONS_IMPLEMENTATION */</span></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * @brief  Gets the page of a given address</span></span><br><span class="line"><span class="comment">   * @param  Address: Address of the FLASH Memory</span></span><br><span class="line"><span class="comment">   * @retval The page of a given address</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"> <span class="type">static</span> <span class="type">uint32_t</span> <span class="title function_">GetPage</span><span class="params">(<span class="type">uint32_t</span> Address)</span></span><br><span class="line"> &#123;</span><br><span class="line">   <span class="type">uint32_t</span> page = <span class="number">0U</span>;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">if</span> (Address &lt; (FLASH_BASE + FLASH_BANK_SIZE))</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="comment">/* Bank 1 */</span></span><br><span class="line">     page = (Address - FLASH_BASE) / FLASH_PAGE_SIZE;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">   &#123;</span><br><span class="line">     <span class="comment">/* Bank 2 */</span></span><br><span class="line">     page = (Address - (FLASH_BASE + FLASH_BANK_SIZE)) / FLASH_PAGE_SIZE;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">return</span> page;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * @brief  Gets the Bank of a given address</span></span><br><span class="line"><span class="comment">   * @param  Address: Address of the FLASH Memory</span></span><br><span class="line"><span class="comment">   * @retval The Flash bank of a given address</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"> <span class="type">static</span> <span class="type">uint32_t</span> <span class="title function_">GetBank</span><span class="params">(<span class="type">uint32_t</span> Address)</span></span><br><span class="line"> &#123;</span><br><span class="line">   <span class="type">uint32_t</span> bank = <span class="number">0U</span>;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">if</span> (Address &lt; (FLASH_BASE + FLASH_BANK_SIZE))</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="comment">/* Bank 1 */</span></span><br><span class="line">     bank = FLASH_BANK_1;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">   &#123;</span><br><span class="line">     <span class="comment">/* Bank 2 */</span></span><br><span class="line">     <span class="comment">//bank = FLASH_BANK_2;</span></span><br><span class="line">     bank=<span class="number">2</span>;</span><br><span class="line">     <span class="comment">//应该没有用，bank2没有定义</span></span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">return</span> bank;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">/* USER CODE END PRIVATE_FUNCTIONS_IMPLEMENTATION */</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * @&#125;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * @&#125;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<p>注意到这部分代码，因为我的型号没有定义flash bank2，所以编译会过不去，我就把这里注释掉了，反正不会走到这里，不影响功能。</p>
<p>如果你的单片机flash比较大可以考虑把这里注释去掉看看能不能正常编译</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503171238186.png" alt="image-20250317123847162"></p>
<p>原始代码是这样</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* Bank 2 */</span></span><br><span class="line">  bank = FLASH_BANK_2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里有几个坑点。</p>
<p>首先这里面的接口函数名字全都是改过的，网上的教程基本上都是老版本，MEM_If_Init_HS之类的函数名字（哭</p>
<p>然后很多以前可用的函数调用现在都没有了，比如Sector Erase根本没这个模式了，只能用page擦除</p>
<p>还有program flash函数也没法用word模式写了，最小就是DWORD，一次写64bit，这里我之前尝试了好久用以前的代码的word模式手动改成DWORD写入，但是一直不成功，每次都报校验失败，用STLINK读内存区一看，偶数地址全都是0没有写入，也就是DWORD的64bit只写了前32bit（哭</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503171245691.png" alt="img"></p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503171247270.png" alt="img"></p>
<p>ps：后面对比官方代码看应该是32bit指针和64bit指针导致的问题，我对于C的指针理解还是太不熟练了，这玩意太容易搞出问题了</p>
<p>总之无视上面这一堆话，<strong>直接copy官方的代码就能稳定跑起来了</strong>，让人感叹天下代码一大抄，自己写永远不如找官方例程抄（乐</p>
<p><strong>最后实现main里的用户程序跳转逻辑和自己的代码功能</strong></p>
<p>实际上dfu的部分是不需要对main做任何修改的，以上的代码改完就可以实现dfu下载的功能了</p>
<p>但是这样上电会永远默认进入DFU模式，也没法跳转进入自己的app，就一直卡在dfu模式了。</p>
<p>所以我们需要在main里加入判断是否进入DFU升级模式的代码和不进入DFU时候直接跳转到用户app代码执行的功能。</p>
<p>首先一点，<strong>如果上电时候执行了 MX_USB_Device_Init();函数（cube自动生成的）就会直接进usb dfu</strong>，电脑会识别到dfu接口</p>
<p>所以我们把cube自动生成的函数调用注释掉，手动加入判断逻辑来决定是否初始化usb dfu</p>
<p>在main函数里定义跳转变量</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE BEGIN 1 */</span></span><br><span class="line">  <span class="keyword">typedef</span> <span class="title function_">void</span> <span class="params">(*pFunction)</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line">  pFunction JumpToApplication;</span><br><span class="line">  <span class="type">uint32_t</span> JumpAddress;</span><br><span class="line">  <span class="comment">/* USER CODE END 1 */</span></span><br></pre></td></tr></table></figure>
<p>在主循环前加入判断是否进入DFU的代码</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"> <span class="comment">/* USER CODE BEGIN 2 */</span></span><br><span class="line"> <span class="keyword">if</span>(!HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_2))  <span class="comment">//上电时PA2 key按下 进入DFU模式</span></span><br><span class="line"> &#123;</span><br><span class="line">   MX_USB_Device_Init(); <span class="comment">//初始化DFU USB</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">while</span>(<span class="number">1</span>)  <span class="comment">//DFU程序</span></span><br><span class="line">   &#123;</span><br><span class="line">     HAL_GPIO_TogglePin(GPIOC, GPIO_PIN_14);</span><br><span class="line">     <span class="comment">//如果进入了dfu程序，绿灯闪烁</span></span><br><span class="line">     HAL_Delay(<span class="number">500</span>);</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//没有进DFU就直接跳到用户程序</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">if</span> (((*(__IO <span class="type">uint32_t</span> *) USBD_DFU_APP_DEFAULT_ADD) &amp; <span class="number">0x2FFC0000</span>) == <span class="number">0x20000000</span>)</span><br><span class="line"> &#123;</span><br><span class="line">   <span class="comment">/* Jump to user application */</span></span><br><span class="line">   JumpAddress = *(__IO <span class="type">uint32_t</span> *) (USBD_DFU_APP_DEFAULT_ADD + <span class="number">4</span>);</span><br><span class="line">   JumpToApplication = (pFunction) JumpAddress;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/* Initialize user application&#x27;s Stack Pointer */</span></span><br><span class="line">HAL_RCC_DeInit();</span><br><span class="line">   HAL_DeInit();	<span class="comment">//关掉你在dfu里初始化的所有外设，防止重新初始化冲突导致程序死掉</span></span><br><span class="line">   __set_MSP(*(__IO <span class="type">uint32_t</span> *) USBD_DFU_APP_DEFAULT_ADD);</span><br><span class="line">   JumpToApplication();</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">/* USER CODE END 2 */</span></span><br></pre></td></tr></table></figure>
<p>如果上电时候按着PA2的按键，就会执行usb初始化，识别到dfu usb设备，然后进入死循环，不再执行下面的跳转代码</p>
<p>这里的循环里可以实现自己想要的dfu固件功能，想写点啥都可以。</p>
<p>也可以自己改进dfu的逻辑，比如通过用户程序复位重新初始化和读写某个存储器里的标志位判断进入dfu来实现代码控制自动升级。</p>
<p>如果没有按下按键，就会往下走，执行跳转用户程序代码。</p>
<p>这部分代码主要是把栈指针和PC程序指针都跳转到用户程序区开始的位置，也就是之前在Cube里定义的那个DFU区结束地址。</p>
<p>注意关掉外设那两句，必须要加，我之前就总是莫名其妙的在跳转进用户程序后单片机死掉，大概是因为冲突导致死进错误中断里了。</p>
<p>到这里DFU固件就改完了，可以编译生成hex</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503171311237.png" alt="image-20250317131141208"></p>
<p>注意改一下代码空间限制，防止写爆了超出DFU固件区。</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503171312986.png" alt="image-20250317131215950"></p>
<p>因为usb代码还挺大的，为了省空间塞进16k里面，我开了这个。</p>
<p>当然如果你的单片机flash够大可以直接给dfu区开个32k或者48k啥的。</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503171314849.png" alt="image-20250317131431826"></p>
<p>空间不太富裕。</p>
<p><strong>然后直接用stlink把dfu固件烧进去就ok了</strong></p>
<p>如果你安装好了cube programmer的驱动，这时候按住按键，插入usb给单片机上电，应该就能看到LED闪烁，并且设备管理器里可以识别出dfu设备了。说明已经正确进入dfu固件。</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503171317078.png" alt="image-20250317131737051"></p>
<p>下面就是编写用户app，需要做一些小修改。</p>
<h2 id="编写用户程序"><a href="#编写用户程序" class="headerlink" title="编写用户程序"></a>编写用户程序</h2><p>正常创建一个工程，随便写你正常需要用的功能</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503171434053.png" alt="image-20250317143429029"></p>
<p>我这里让红绿两个LED都闪烁</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503171436729.png" alt="image-20250317143633705"></p>
<p>然后修改下程序起始地址和空间大小（还剩112k，之前算过，填进去）</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503171438547.png" alt="image-20250317143845503"></p>
<p>最后修改下中断向量表偏移，也就是偏移掉DFU的16k地址区，<strong>记得把前面那行取消注释，不然不会生效</strong>。</p>
<p>编译，生成hex文件。</p>
<h2 id="DFU下载"><a href="#DFU下载" class="headerlink" title="DFU下载"></a>DFU下载</h2><p>进到dfu模式，打开cube programmer</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503171442192.png" alt="image-20250317144225144"></p>
<p>选usb，刷新一下选你找到的端口，连接</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503171442007.png" alt="image-20250317144245980"></p>
<p>这是正常连接的样子</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503171443286.png" alt="image-20250317144316240"></p>
<p>选刚才编译的用户程序hex文件，正常下载即可。</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503171443285.png" alt="image-20250317144344243"></p>
<p>下载成功。因为选了运行程序，所以会自动复位跳转到用户程序，usb连接会丢失。</p>
<p>此时已经可以看到用户程序正常运行，两个led灯都在闪烁。</p>
<h2 id="一些测试"><a href="#一些测试" class="headerlink" title="一些测试"></a>一些测试</h2><p>连stlink读一下内存</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503171446034.png" alt="image-20250317144650962"></p>
<p>DFU固件的代码大概到了3900这个位置，也就是14k的代码大小</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503171447893.png" alt="image-20250317144759822"></p>
<p>4000开始是用户程序代码，可以看到第一个数就是我们MSP堆栈指针的值</p>
<p>我在cube programmer里用stlink重新刷写了一遍用户程序，对比了下内存空间，发现是一致的，说明DFU烧录的代码是正确的。</p>
<p>并且也不会覆盖掉前面的DFU代码（用cube prog重新烧写dfu固件也不会覆盖用户程序）</p>
<p><strong>所以依然可以正常使用stlink进行用户程序的调试和下载，不影响正常的编写调试</strong></p>
<p>尝试用DFU升级DFU固件，会报错失败，而且把程序写坏掉，不要这么做（前面16k地址空间是不可写的）</p>
<h2 id="待续"><a href="#待续" class="headerlink" title="待续"></a>待续</h2><ul>
<li>使用CubeIDE实现（需要改链接脚本来控制地址偏移）</li>
<li>程序控制的自动重启OTA</li>
<li>自定义的DFU上位机集成</li>
<li>…</li>
</ul>
]]></content>
      <tags>
        <tag>软件</tag>
        <tag>嵌入式</tag>
      </tags>
  </entry>
  <entry>
    <title>PyQt入门笔记</title>
    <url>/2023/05/05/PyQt%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<p>我不当鸽子啦！</p>
<p>久违的和工作室的小伙伴们一起做项目。不能再鸽啦</p>
<p>给我分了个写上位机GUI的活…我这哪里像是很会软件的样子啊摔</p>
<p>得有一年没怎么敲过代码了吧</p>
<p>要说GUI，当年也学过点半吊子electron，但是这里还是用py更方便点吧。反正都是从头学差不多嘛</p>
<p>看了下PY下靠谱的GUI库，还是用经典的qt吧</p>
<p>这里姑且记一下学习记录吧。反正个人博客不就是拿来随缘记录的么</p>
<span id="more"></span>
<h1 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h1><p>先来个hello world</p>
<p>在vsc终端下面装一下库本体 py环境用的系统上装的3.10.7</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line"># 安装PyQt5</span><br><span class="line">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple PyQt5</span><br></pre></td></tr></table></figure>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202305050053351.png" alt="image-20230505005312326"></p>
<p>ok 这个警告和path有关，看起来可以先不管</p>
<p>简单跑个hello world</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">import sys</span><br><span class="line">from PyQt5.QtWidgets import QApplication, QWidget, QLabel, QVBoxLayout</span><br><span class="line"></span><br><span class="line"># 建立application对象</span><br><span class="line">app = QApplication(sys.argv)</span><br><span class="line"># 建立窗体对象</span><br><span class="line">w = QWidget()</span><br><span class="line"># 设置窗体大小</span><br><span class="line">w.resize(500, 500)</span><br><span class="line"></span><br><span class="line"># 设置样式</span><br><span class="line">w.layout = QVBoxLayout()</span><br><span class="line">w.label = QLabel(&quot;Hello World!&quot;)</span><br><span class="line">w.label.setStyleSheet(&quot;font-size:25px;margin-left:155px;&quot;)</span><br><span class="line">w.setWindowTitle(&quot;PyQt5 窗口&quot;)</span><br><span class="line">w.layout.addWidget(w.label)</span><br><span class="line">w.setLayout(w.layout)</span><br><span class="line"></span><br><span class="line"># 显示窗体</span><br><span class="line">w.show()</span><br><span class="line"># 运行程序</span><br><span class="line">sys.exit(app.exec_())</span><br></pre></td></tr></table></figure>
<p>槽 这hello world 也够复杂…看着任重道远啊</p>
<p>管他，先Ctrl+F5</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202305050058457.png" alt="image-20230505005811438"></p>
<p>ok，今天的学习就先到这里啦！欲知后事如何…反正之后再说~</p>
]]></content>
      <tags>
        <tag>软件</tag>
      </tags>
  </entry>
  <entry>
    <title>Lora训练学习笔记</title>
    <url>/2023/03/19/Lora%E8%AE%AD%E7%BB%83%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<p>也总算是狠下心换了新电脑，主要原因就是之前跑涩图卡的太不爽动不动就爆显存…呃这个理由真的没问题吗</p>
<p>既然电脑也换了那也不能再摆烂天天拿着别人的lora和模型瞎玩了</p>
<p>代码学不明白，用脚本训练总能学一下吧…之前教程看了不少但是技术日新月异啊，之前看的现在也过时了不少，在这里感谢b站几个一直更新教程的up们，互联网分享精神永存</p>
<p>看教程看的头疼到现在也不知道能不能成功总之一步一步跟着来吧，学会多少记多少。感觉上了一年班自己的代码能力啊python啊计算机知识啥的都快还给老师了…还能不能捡的起来呢</p>
<span id="more"></span>
<h1 id="配环境"><a href="#配环境" class="headerlink" title="配环境"></a>配环境</h1><p>python和git不多说了，教程推荐3.10.8或者3.10.9，看了下自己的3.10.7，也懒得更新了，估计差别不大吧，先用着，<del>翻车了再来改</del></p>
<p>lora脚本用的秋叶佬的，虽然听说有lora gui了不过还是先从教程详细的玩起吧~</p>
<p>建个文件夹脚本git下来不多说</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone --recurse-submodules https://github.com/Akegarasu/lora-scripts</span><br></pre></td></tr></table></figure>
<p>然后右键用powershell运行一下install.ps1，开始装环境</p>
<p>好大的pytorch…每个包都要创建一个新的虚拟环境，然后下一遍torch是这样的</p>
<p>不得不说世界上最大的东西除了node_modules还有python venv（笑</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202303192155395.png" alt="image-20230319215549361"></p>
<p>最后显示install compete就装完了。不得不说真大啊</p>
<p>各种报错各种慢 然后我折腾完之后发现有个cn加速的安装脚本（</p>
<p>我真傻</p>
<h1 id="整理训练集"><a href="#整理训练集" class="headerlink" title="整理训练集"></a>整理训练集</h1><p>torch没卡我结果一个numpy十几m开始卡下载了，可能是这个没换源吧，也懒得从头来了等一会吧，趁这个时间先整理下训练集。<del>！！记得换源，我被折磨了半小时才想起来确认下我有没有换源我就是个纯纯的。。</del></p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">pip config <span class="keyword">set</span> <span class="keyword">global</span>.index-url https:<span class="comment">//pypi.tuna.tsinghua.edu.cn/simple</span></span><br></pre></td></tr></table></figure>
<p>看了各种教程训练集讲究就多了，从画风统一度，裁剪方法，角度服装等等包含的程度，大抵每个炼丹师都应该知道，丹的好坏，训练集是最重要的吧。</p>
<p>但是这里既然学习流程，就先不想那么多了，找个最简单的人物训练，自动裁切自动打标走一波也不折腾难的了。</p>
<p>dalao说推荐个人用50张图左右，分辨率就用512*768吧，先找图。</p>
<p>图片是用Moeloader从d站镜像站上拖下来的单人物tag的图片，随便挑选了看着比较好的70张，放个文件夹。不要用中文路径这个应该不用提了吧（</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202303192209123.png" alt="image-20230319220956075"></p>
<p>然后开webui，先切图。设好输入输出目录</p>
<p>我这里用tagger去打tag，就不开训练里的自动tag了，但是把自动焦点开一下。预处理。</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202303192212605.png" alt="image-20230319221245570"></p>
<p>切完初步扫了一下效果还ok，没有太离谱的。横向的切出来效果不太好不过也无伤大雅</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202303192215902.png" alt="image-20230319221504857"></p>
<p>然后打tag，tag反推，批量操作，阈值按教程用0.3</p>
<p>tag有各种玩法，这里也复杂得很，没看多明白…还是先用最简单的全标吧，按dalao说法，全标效果倒是也不差</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202303192219140.png" alt="image-20230319221929092"></p>
<p>又要下一堆模型emmm 然后反推倒是很快</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202303192231486.png" alt="image-20230319223112453"></p>
<p>把反推完的tag扔到训练图的文件夹里去</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202303192231385.png" alt="image-20230319223137350"></p>
<p>到这里训练集就处理完了。待用。</p>
<h1 id="设置训练参数"><a href="#设置训练参数" class="headerlink" title="设置训练参数"></a>设置训练参数</h1><p>在训练脚本文件夹下面建个train文件夹，再建个本次训练的文件夹，名字随便</p>
<p>然后下面再建一个X_训练名字 的文件夹，X就是说的那个repeat次数，一个图像重复多少次。我这里写个10。后面名字随便。</p>
<p>这里其实进阶会用来区分不同的参数来训练，我这里先不管了，就塞一个文件夹，把刚才目录下的训练图片和tag文件都丢进去</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202303192241972.png" alt="image-20230319224101940"></p>
<p>然后改train.ps1训练脚本</p>
<p>这个就有点复杂了，秋叶佬的教程写的比较明白。还是先按简单的通用设置来吧，改的就只有红圈的部分</p>
<p>底模一般都推荐用full 7.2G原始大模型</p>
<p>分辨率改一下</p>
<p>batch按理说可以开大点不过也就是加快点速度所以还是算了</p>
<p>epoch可以开大点反正就算过拟合了每轮也有保存不影响什么</p>
<p>dim就不改了 学习率这种进阶的东西也不改了</p>
<p>优化器用了lion据说效果好一点</p>
<p>locon没学明白，先不开</p>
<p>好了保存然后开始训练</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202303192314544.png" alt="image-20230319231411483"></p>
<h1 id="训练！"><a href="#训练！" class="headerlink" title="训练！"></a>训练！</h1><p>训练没啥好说的，右键开始就好了（又要下一堆东西 等吧…emmm）</p>
<p>然后开始欣赏显卡的轰鸣…是真的很慢…</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202303192355791.png" alt="image-20230319235551770"></p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202303192355399.png" alt="image-20230319235536361"></p>
<h1 id="测试模型"><a href="#测试模型" class="headerlink" title="测试模型"></a>测试模型</h1><p>因为设置了每2个epoch保存一次，所以其实不用等都训练完了，保存一次模型就可以测试一下了</p>
<p>而且其实也不需要训练40轮这么多 </p>
<p>按照dalao的经验，数据集差不多够多，打标没问题的情况下，6-8轮10轮以内就很好了，太高了还会过拟合</p>
<p><del>我自己感觉2轮的甚至都很像模像样了，可能我的训练集比较多吧</del></p>
<p>我跑了40轮只是测试一下看看这样</p>
<p>不过感觉lora不好的一点还是每次训练完也没有个预览图，还得自己把模型copy出去然后在webui里测试…这属实是有点不方便</p>
<p>总之目前还没跑完，先试试10轮的，很满意！</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202303200002445.png" alt="image-20230320000201974"></p>
<h1 id="一些小tips"><a href="#一些小tips" class="headerlink" title="一些小tips"></a>一些小tips</h1><p>1.关于打标，打全标最简单，但是很愚蠢的一点就是用的时候必须也调用上一些tags标记，不然就会缺特征，因为打标在tags里的特征其实是不会被包含在lora本身里的，必须自己在调用时候写上去…</p>
<p>所以其实对于人物lora来说最优的方法是手动删除人物特性相关的打标，但是属实有点麻烦…</p>
<p>再摆烂点就是不打，但好像是容易过拟合吧…</p>
<p>等我再研究研究明白再来说</p>
<p>2.训练尺寸，我的图基本都是竖向的，512*512训练切图其实有点厉害，导致上面画出来的图头顶很多都没了…可能还是得参考原图比例来切图和训练比较好吧</p>
<p>3.40系卡要不要替换cudnn，我没看有人提过lora要不要换，不过我换了下正常用是没问题，有没有提升没有仔细对比，不知道有没有人清楚了 </p>
<p>更新下，实测换一下好像还是有提升的，但是也没有很夸张那种。</p>
<p>4.训练batch数，我们不考虑显存的情况下，肯定越大越快，但是据说开大了会过拟合什么的，看dalao建议是说设成图片轮数（也就是图片数*文件夹名字前面那个repeat数，比如我这个70张图repeat 10就是700）的1/60左右。（这么看我这个数据量有点大了，好像一般推荐2，300这样，可能我应该减一点repeat数）</p>
<p>5.正则化 没看明白 待我以后再研究研究</p>
<h1 id="打标那些事"><a href="#打标那些事" class="headerlink" title="打标那些事"></a>打标那些事</h1><p>1.直接打全标感觉拟合效果比较好的，但是用起来很麻烦，还得把那些tag文件里高频的tag都写进去才能正常出图</p>
<p>2.另一个方法是只打一个触发词，还有留下姿势动作这些tag，这种试了下感觉还可以，用起来方便，但是如果留了姿势的tag，那要开一个keep token 1 不然训练就乱了</p>
<p>这个方法可以参考dalao的文章，有一个一键处理脚本，很好很方便</p>
<p><a href="https://www.bilibili.com/read/cv22050074?from=articleDetail">https://www.bilibili.com/read/cv22050074?from=articleDetail</a></p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202303200138727.png" alt="image-20230320013839698"></p>
<p>3.手动改标…真的好麻烦</p>
<p>你让我用这种方法我是拒绝的www 懒癌发作了</p>
<h1 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h1><p>b站：秋叶，星空佬，等等</p>
<p>参考资料：几个dalao的教程，特别是这个，很详细</p>
<p><a href="https://www.bilibili.com/read/cv22274249?spm_id_from=333.999.list.card_opus.click">https://www.bilibili.com/read/cv22274249?spm_id_from=333.999.list.card_opus.click</a></p>
]]></content>
  </entry>
  <entry>
    <title>VtuberStudio配置选择和模型调参</title>
    <url>/2025/02/14/VtuberStudio%E9%85%8D%E7%BD%AE%E9%80%89%E6%8B%A9%E5%92%8C%E6%A8%A1%E5%9E%8B%E8%B0%83%E5%8F%82/</url>
    <content><![CDATA[<p>好久没用Vtuber Studio了，最近闲下来了，想掏出来玩点游戏，想起之前用USB摄像头模型效果一直不太好，比较僵硬，还经常丢追，于是去b站搜一下调优方法，看了一晚上，头昏脑胀ing</p>
<p>这一两年没碰，新技术还挺多的，姑且记录一下调试的过程吧</p>
<span id="more"></span>
<h1 id="1-OBS输入源选择"><a href="#1-OBS输入源选择" class="headerlink" title="1. OBS输入源选择"></a>1. OBS输入源选择</h1><p>参考：vts官方wiki</p>
<p><a href="https://github.com/Mouwoo/VTubeStudio/wiki/Recording-Streaming-with-OBS">https://github.com/Mouwoo/VTubeStudio/wiki/Recording-Streaming-with-OBS</a></p>
<p>对于win平台，Vtuber Studio（VTS）有几种常用的输出可选</p>
<ul>
<li>obs游戏采集vts进程</li>
<li>obs采集vts虚拟摄像头</li>
<li>spout2插件输出</li>
<li>NDI网络接口推流（没用过）</li>
</ul>
<p>前面俩比较常用，都是老方法了</p>
<p>第一种最简单方便，问题在于vts的UI也会被采集到obs，在直播的时候如果要调vts软件设置就不太方便。</p>
<p>虚拟摄像头需要装个驱动，用起来也比较方便，不会采集到vts UI，据说画质没有第一种好（存疑）</p>
<p>用法参考wiki，b站也介绍很多</p>
<p>说下spout2，这个应该是新加的，也没看到啥视频介绍，但是在wiki上官方最推荐这个方法</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202502141944443.png" alt="image-20250214194459415"></p>
<p>看起来很棒</p>
<p>不过需要手动给obs装一个插件</p>
<p>官方的安装指南：<a href="https://knowledge.offworld.live/en/spout-plugin-for-obs-studio/how-to-install-the-spout-plugin-for-obs-studio">https://knowledge.offworld.live/en/spout-plugin-for-obs-studio/how-to-install-the-spout-plugin-for-obs-studio</a></p>
<ol>
<li><p>关掉obs</p>
</li>
<li><p>下载最新版本：<a href="https://github.com/Off-World-Live/obs-spout2-plugin/releases（第一个，自动安装的，这玩意很久没更新了啊，适配的还是obs29，不过实测看起来在最新的obs31里用起来是ok的）">https://github.com/Off-World-Live/obs-spout2-plugin/releases（第一个，自动安装的，这玩意很久没更新了啊，适配的还是obs29，不过实测看起来在最新的obs31里用起来是ok的）</a></p>
</li>
<li><p>一路next结束</p>
</li>
<li><p>在vts里打开spout2输出（和其他方法一样，背景还是依然用纯色+允许透明）</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202502141951181.png" alt="image-20250214195126138"></p>
</li>
<li><p>在obs里加一个spout2输入，如图配置一下，ok</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202502141953434.png" alt="image-20250214195350401"></p>
</li>
</ol>
<h1 id="2-小技巧"><a href="#2-小技巧" class="headerlink" title="2. 小技巧"></a>2. 小技巧</h1><p>给vts设置为管理员启动（对steam打开也生效）</p>
<p>wiki说可以增加进程优先级，降低延迟和卡顿（谁知道呢）</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202502150012000.png" alt="image-20250215001240940"></p>
<h1 id="3-追踪方式"><a href="#3-追踪方式" class="headerlink" title="3.追踪方式"></a>3.追踪方式</h1><p>常用的面捕方法有这么几种</p>
<ul>
<li>VTS内置追踪直接调用电脑usb摄像头（最简单，效果差）</li>
<li>电脑usb摄像头输入，VTS调用NVDIA面捕或者Google的面捕（比上面好，但是依然受摄像头限制）</li>
<li>VTS ios端调用苹果iPhone面捕api，局域网推流面捕数据给电脑本地VTS调用（精度高，效果好）</li>
<li>VTS ios端面捕，推流给电脑上的VBridger，VB推流给电脑端VTS调用（使用复杂，效果最好，可以实现额外的动作效果）</li>
</ul>
<p>其实还有几种其他的搭配，比如电脑摄像头配VB，感觉意义不大就不多提</p>
<p>这里苹果的面捕api比起电脑摄像头有绝对的优势，这个是硬件差距，包括苹果的面捕摄像头硬件和ios的api生态。实测来看，不管是vts的面捕还是n卡面捕啥的，在我这种双屏常转头+摄像头比较远+摄像头在底侧向上拍的情况下，都无法避免丢追。但是ios的面捕工作稳定。</p>
<p><strong>所以一般来说都会建议有条件的情况下使用苹果面捕</strong>（我这里是淘汰下来的老iPhone13正好再利用了，用了个手机支架横着放在电脑屏幕下面）</p>
<p>然后是vb，vb是一个面捕软件，通过接收苹果api的面捕数据，二次计算得到更复杂精细的面部建模和追踪，用来驱动vts。</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503280030435.png" alt="image-20250328003021305"></p>
<p>关于用不用vb，当然vb可以实现很多高级的复杂表情识别，但是这个是依赖你的模型建模的，如果你的模型没有做这些高级的输入绑定，那其实vb也无法帮你实现更高级的效果（我的模型就是普通的）</p>
<p>如果你的模型是适配vb的，那当然肯定要用vb</p>
<p>但是即使模型是普通的，也还是可以用的，vb是支持兼容普通模型的模式的，只不过就实现不了高级的表情，还占用电脑资源，增加复杂度</p>
<p>然而我试过之后还是用了手机vts+VB+电脑vts的方案，原因是是啥呢</p>
<p>首先吧</p>
<p><strong>你用vb是可以不用买手机版vts的，手机vts要150，vb只要30多</strong></p>
<p>众所周知如果你直接用手机vts推流电脑vts，如果不买手机端vts，5分钟就会自动断连</p>
<p>但是如果你用vb，vb是使用第三方客户端连接接口，不通过推流接口，所以并不会受这个影响，是可以正常使用的，也就是其实只用买个vb就好了（这里不涉及破解啥的，完全是正常的功能使用）</p>
<p>但是其实这是小事，vb还有个好用的地方…他可以调输出曲线！</p>
<p>这个等会说</p>
<p>先说下配置</p>
<h2 id="工作流配置"><a href="#工作流配置" class="headerlink" title="工作流配置"></a>工作流配置</h2><p>首先保证iPhone和电脑在一个路由器局域网下面</p>
<p>然后装ios的vts，不用装模型，直接开设置，拉到最下面第三方客户端，打开它（不用开pc推流）</p>
<p>再点下显示ip，记下iPhone的局域网ip备用</p>
<p>然后打开vb，载入</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503280037599.png" alt="image-20250328003704492"></p>
<p>如果你是vb模型可以用前面那些高级的，我是普通模型就用了最后那个兼容配置</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503280037391.png" alt="image-20250328003752365"></p>
<p>把刚才的ip写在这里，连接上iPhone</p>
<p>这时候vb里的模型应该已经可以动了</p>
<p>然后打开电脑版vts</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503280040029.png" alt="image-20250328004016998"></p>
<p>在设置里给这个打开</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503280040969.png" alt="image-20250328004059943"></p>
<p>去vb下面选vts，点右边的连接</p>
<p>然后去vts里点同意</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503280041156.png" alt="image-20250328004152122"></p>
<p>这里插件应该连上了，你的模型也会动了</p>
<p>搞定~</p>
<p>剩下的就和正常的vts配置一样了，b站教程很多</p>
<p>注意这么做的情况下，电脑端vts的所有面捕参数都不生效，比如灵敏度啥的</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503280043442.png" alt="image-20250328004307411"></p>
<p>这些都不生效，由手机端控制</p>
<p>同样的，手机端所有模型配置都不生效</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503280043406.png" alt="image-20250328004341367"></p>
<p>包括这些模型参数，表情啥的</p>
<p>可以理解为现在被拆成了两部分，手机只负责面捕，电脑只负责渲染模型</p>
<h2 id="关于vb和曲线"><a href="#关于vb和曲线" class="headerlink" title="关于vb和曲线"></a>关于vb和曲线</h2><p>这里就说到为什么要用vb了</p>
<p>众所周知vts的参数输入映射是一个一次函数</p>
<p>也就是[x,y]到[i,j]的一个线性映射（前面是你的面捕参数，后面是给模型的驱动参数）</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503280110598.png" alt="image-20250328011019567"></p>
<p>这里怎么调都是线性的，在大部分情况下，通过调这四个值的范围来控制表情的动作幅度，常态表情是什么都是可以实现的</p>
<p>但是有些时候就会有问题</p>
<p>比如我这里的睁眼参数</p>
<p>在我对着主屏幕看的时候，这个参数大概是0.7左右，正常来说我要把这个常态调整到输出给模型的1.0（也就是正常睁眼）</p>
<p>大概是上面这个映射值</p>
<p>但是当我稍微转头，看左边的屏幕，就出问题了</p>
<p>这时候面捕识别到的睁眼参数会下降到0.4~0.5左右，实际上我还是睁眼，但是就会变成这样</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503280112523.png" alt="image-20250328011230412"></p>
<p>输出只有0.7了，变成了半闭眼，就很诡异</p>
<p>只有我的输入参数到了0.2，0.3，也就是接近闭眼或者眨眼的情况，我才希望模型闭眼，不然就维持在睁眼的状态（比如转头看侧屏的时候应该是睁眼）</p>
<p>通过这个简单的输入映射，就没法解决这个问题</p>
<p>一个办法是改模型的控制参数里的变形器绑定，相当于直接修改模型动作，但是很明显模型不好改，一般来说都不会有源文件</p>
<p><strong>那么用vb的曲线就可以解决这个问题</strong></p>
<p>首先我们常态的输入是0.7，这时候眼睛的驱动参数是1左右，是正常的</p>
<p>然后我转头，最差的情况输入下降到了0.4</p>
<p>我希望在0.4~0.7的输入情况下模型的眼睛都不会明显闭眼，也就是把0.4~0.7的输入都映射到0.7左右的输出</p>
<p>那么我们改曲线</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503280117092.png" alt="image-20250328011709060"></p>
<p>手动加两个控制点</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503280127754.png" alt="image-20250328012742732"></p>
<p>总之修成大概0.4到0.7的区间输出都是0.65左右就好了</p>
<p>这样也不影响前后段的眼睛动作（比如闭眼，眨眼和睁大眼）</p>
<p>ok~</p>
<p>这玩意用法应该还有挺多的，就看怎么开发了</p>
<p>结</p>
]]></content>
      <tags>
        <tag>软件</tag>
      </tags>
  </entry>
  <entry>
    <title>esp32s3&amp;arduino&amp;PlatformIO环境配置&amp;st7789点屏&amp;lvgl学习笔记</title>
    <url>/2024/02/16/esp32s3%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<p>翻开一看又是半年没有写什么东西了</p>
<p>想着行动力行动力但是下班之后就好想睡觉</p>
<p>彻底变成了社畜的模样</p>
<p>但是哪怕迷茫也要前进呀</p>
<p>趁着年前熟悉一下很久就想学但是一直没学两三年没碰都快要忘干净了的一些事吧</p>
<p>比如怎么用单片机和一块彩屏画出一个好看的UI？也熟悉一下比较新的器件和开发方式吧</p>
<p>权当是复健咯</p>
<p>想了想还是尽量写写blog做笔记吧 方便日后又忘得差不多了的时候翻来复习？虽然也有用OneNote来记录的习惯但是还是太零散了 翻找起来也麻烦</p>
<span id="more"></span>
<h1 id="关于mcu和开发板"><a href="#关于mcu和开发板" class="headerlink" title="关于mcu和开发板"></a>关于mcu和开发板</h1><p>现在新鲜的mcu真挺多</p>
<p>有时候感觉自己还在几年前的f103c8t6小蓝板的时代</p>
<p>也确实是太久没玩什么新东西了</p>
<p>虽然esp32s3也算不上什么太新的玩意 不过生态也比较成熟 资料挺多 性能也够强，想要推屏幕的话，想着还是要找个主频高内存大的片子，就用它吧</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202402161736488.png" alt="image-20240216173601424" style="zoom:50%;" /></p>
<p><del>乐鑫的产品线真够乱的（摔</del></p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202402161731512.png" alt="img" style="zoom:50%;" /></p>
<p>去某宝随便买了个看着顺眼的核心板<del>长得很像小蓝板很亲切</del></p>
<p>这里是资料：<a href="https://wiki.luatos.com/chips/esp32s3/board.html">https://wiki.luatos.com/chips/esp32s3/board.html</a></p>
<p>原理图也很简单</p>
<p><img src="https://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/image-20230109142605987.png" alt="image-20230109142605987"></p>
<p><img src="https://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/image-20230109142929589.png" alt="image-20230109142929589"></p>
<h1 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h1><p>esp32主流的开发环境应该算是有两套</p>
<p>一个是官方的esp-idf的C sdk，功能齐全资料也完善，不过听说在win下配环境比较麻烦，学习起来也略微繁琐</p>
<p>另一个就是arduino固件的支持，写起来简单，兼容arduino库用起来方便，但是对mcu底层就没那么好操控了</p>
<p>因为是初步入门复健所以还是先用简单的arduino吧</p>
<h2 id="arduino-IDE环境"><a href="#arduino-IDE环境" class="headerlink" title="arduino IDE环境"></a>arduino IDE环境</h2><p>下了个最新的arduino IDE</p>
<p>不得不说虽然2.0的arduino界面变了很多 但是难用这一点上还是一如既往</p>
<p>配置倒是很简单 点开开发板管理器 搜esp32 然后直接装这个官方的包就好了</p>
<p>不过要自备魔法手段 网络并不太好 包挺大的得装一会（装不上的话还有各种手段 这里不谈</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202402161757800.png" alt="image-20240216175723742"></p>
<p>装完之后随便选一个esp32s3的板子</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202402161759611.png" alt="image-20240216175937562"></p>
<p>看下上面的开发板pinmap，GPIO10和11就是两颗LED 想想如果脑子正常的话esp32的gpio和arduino的gpio号应该是一样的吧（应该？）<del>别跟树莓派那样有好几种编号就好</del></p>
<p>于是随便撸了一个hello world试一下</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// put your setup code here, to run once:</span></span><br><span class="line"> Serial.begin(<span class="number">921600</span>);</span><br><span class="line"> Serial.print(<span class="string">&quot;hello world!\n&quot;</span>);</span><br><span class="line"> pinMode(<span class="number">11</span>,OUTPUT);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// put your main code here, to run repeatedly:</span></span><br><span class="line">  digitalWrite(<span class="number">11</span>,HIGH);</span><br><span class="line">  delay(<span class="number">500</span>);</span><br><span class="line">  digitalWrite(<span class="number">11</span>,LOW);</span><br><span class="line">  delay(<span class="number">500</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>插上usb，可以自动识别com号，编译，下载</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202402161804003.png" alt="image-20240216180430952"></p>
<p>闪灯ok，串口输出ok</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202402161805250.png" alt="image-20240216180539203"></p>
<p>第一步算是跑起来了</p>
<h3 id="碎碎念"><a href="#碎碎念" class="headerlink" title="碎碎念"></a>碎碎念</h3><p>本来还想的很复杂 因为这块合宙的开发板默认推荐的开发环境是他们自家的sdk（猜应该也是一种上层封装的固件吧，没仔细研究）</p>
<p>还想着是不是还得需要先去刷入arduino的固件，刷bootloader什么的</p>
<p>照着网上搜的arduino环境配置方法去先这样直接点了下载也只是想先尝试一下</p>
<p>没想着能成功的</p>
<p>结果一遍就刷进去了 草</p>
<p>看起来似乎这个arduino的工作方式不是以前传统AVR的那种通过bl支持的？是直接用arduino库编译了一个普通的esp32固件然后用串口isp烧录进去就ok了吗</p>
<p>好吧 先不管了 总之是搞定了 这方面的细节就之后有机会再学习了吧</p>
<h1 id="尝试点屏"><a href="#尝试点屏" class="headerlink" title="尝试点屏"></a>尝试点屏</h1><h2 id="关于屏幕"><a href="#关于屏幕" class="headerlink" title="关于屏幕"></a>关于屏幕</h2><p>练手就从最简单经典的搞起吧</p>
<p>去x宝买了块最经典的st7789的2寸320x240全彩tft </p>
<p>感慨下现在屏幕也挺便宜了 这种全彩的十块上下就能买到了</p>
<p>还记得以前黑白12864都是珍贵东西要二三十的年代…</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202402171845236.png" alt="image-20240217184500156"></p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202402171843774.png" alt="image-20240217184321744"></p>
<p>没啥可说的 很简单的玩意</p>
<p>懒得打板所以顺便搞了个fpc转接板然后用杜邦线连了一下</p>
<p>这里重要的IO就是SPI的三根线、RST复位、DC数据命令选择这五个</p>
<p>也没多想直接按着上面的开发板pinmap把SPI接到了14、17、18（屏幕都是从机spi，只用TX单向所以只接了MOSI），剩下RST和DC随便接了IO 0和1</p>
<p>嗯…这就为后面埋下了大坑</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202402171848276.jpg" alt="QQ图片20240217184750"></p>
<h2 id="通用驱动库点亮测试"><a href="#通用驱动库点亮测试" class="headerlink" title="通用驱动库点亮测试"></a>通用驱动库点亮测试</h2><p>直接上lvgl好像有点太快了</p>
<p>还没有点亮呢 至少先驱动起来看看</p>
<p>于是找个普通的st7789驱动库吧</p>
<p>屏幕卖家自然是带了一些例程代码的</p>
<p>但是翻了一下，不是51的就是stm32的。大概读了一下代码，就是基础的底层驱动，还有画线写字之类的简单图形库。虽然也不是不能把这玩意移植到arduino上，但是这不是懒嘛…</p>
<p>都用arduino了，图的不就是不用自己写库么</p>
<p>so放弃卖家的库，想来7789这种烂大街的玩意肯定有一堆开源库，屏幕不太特殊的话应该是可以直接点亮的吧</p>
<p>去arduino上搜一搜好了</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202402171857833.png" alt="image-20240217185716780"></p>
<p>果然出来了一大堆</p>
<p>既然只是测试用（之后还是要换lvgl的），也就没太考虑去比较哪个库更好</p>
<p>第一个看着就ok，装来试一下吧</p>
<hr>
<p>未完待续…</p>
]]></content>
      <tags>
        <tag>嵌入式</tag>
      </tags>
  </entry>
  <entry>
    <title>ZYNQ入门日记</title>
    <url>/2025/03/30/ZYNQ%E5%85%A5%E9%97%A8%E6%97%A5%E8%AE%B0/</url>
    <content><![CDATA[<p>所谓成长，大概也是跨越曾经无法挑战的困难吧…</p>
<p>所以在大学失败一次，毕业后失败一次，失败了n次之后，再一次尝试学习fpga来啦…</p>
<p>我得说真的是丢人到爆了（</p>
<p>虽然很不想碰，但是还是避不开的玩意啊这东西</p>
<p>其实我一直还挺喜欢zynq这玩意的设计理念的，集成度高，性能强，还贼便宜（在国内环境下）</p>
<p>你妹小黄鱼的7010已经到了4块拆机带板的程度了…翻新好的也就七块</p>
<p>我买个G431还要10块呢（摔</p>
<p>所以重新来挑战一下吧…</p>
<p>屎山无边，回头是岸，努力攀登吧</p>
<blockquote>
<p>参考：</p>
<ul>
<li>教程系列<a href="http://www.hellofpga.com/index.php/2023/02/17/ebaz4205_source/">http://www.hellofpga.com/index.php/2023/02/17/ebaz4205_source/</a></li>
<li>正点原子领航者zynq教程文档</li>
<li>其他网络资料、群友们和deepseek的帮助</li>
</ul>
<p>感谢相关教程</p>
</blockquote>
<span id="more"></span>
<h1 id="day1-找硬件，矿板改造，装开发环境"><a href="#day1-找硬件，矿板改造，装开发环境" class="headerlink" title="day1 找硬件，矿板改造，装开发环境"></a>day1 找硬件，矿板改造，装开发环境</h1><h2 id="改板子"><a href="#改板子" class="headerlink" title="改板子"></a>改板子</h2><p>首先我们需要一个开发板对吧<img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503301934452.jpg" alt="ebaz4205"></p>
<p>在之前某次尝试的时候凑热闹买了个咸鱼爆火的矿板，就这玩意（那时候zynq还没降价到现在这样，四五十的7010核心板已经很便宜的夸张了），一直没怎么玩，先拿来入门下吧</p>
<p>没去用正经的开发板也是想更多的体验下对硬件的探索，熟悉这玩意的外围电路，毕竟是想要拿来做系统的软硬件都得学习吧</p>
<p>另外就是群友的大作jlc开源核心板，非常的强大。这东西应该也已经很火了吧</p>
<p>已经在准备啦，感谢立创的免费打板，正在采购备料中…打算等熟悉一点之后拿来替换这个矿板</p>
<p>这里是链接：<a href="https://oshwhub.com/z_star/zynq7020-core-board-and-various-rf-modules">https://oshwhub.com/z_star/zynq7020-core-board-and-various-rf-modules</a></p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503301933249.png" alt="img"></p>
<p>关于矿板，在网上找到了很不错的资源汇总教程，我也姑且先按照这个来探索一下</p>
<p><a href="http://www.hellofpga.com/index.php/2023/02/17/ebaz4205_source/">http://www.hellofpga.com/index.php/2023/02/17/ebaz4205_source/</a></p>
<p>先是过一遍电路图，pcb，熟悉下布局（这玩意竟然是protel的…用ad可以导入就是）</p>
<p>参考文章做一下改造：引出电源接口，焊jtag排针，串口排针，sd卡槽，pl端晶振</p>
<p><a href="http://www.hellofpga.com/index.php/2024/02/01/ebaz4205_re/">http://www.hellofpga.com/index.php/2024/02/01/ebaz4205_re/</a></p>
<p>改完长这样，调试器是某宝买的烂大街兼容品（拆开看下里面没有意外是一颗ft232，标准方案，做这么大实在是属于撑的…）</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503301938654.jpeg" alt="img"></p>
<h2 id="装软件"><a href="#装软件" class="headerlink" title="装软件"></a>装软件</h2><p>IDE的话在群友的建议下装了vivido 2018.3，比较经典的版本，bug少，轻便，占空间小（新版vivado一下就一两百G尼玛…比小而美还吓人）</p>
<p>网上教程一堆，不多说</p>
<p>然后推荐一下偶然发现的vscode插件，Digital IDE。感觉功能挺丰富的，用vsc编辑代码感觉就现代多了（</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503301944788.png" alt="image-20250330194432704"></p>
<p>还能提供原语补全啊语法检查之类一坨东西，对vivado支持也不错</p>
<p>这里是官网，推荐一下：<a href="https://nc-ai.cn/">https://nc-ai.cn/</a></p>
<p>以及感谢群友的blog文章和提供的帮助</p>
<p><a href="https://badboy2002.xyz/2025/03/06/note/fpga-kai-fa-gong-ju-lian/">https://badboy2002.xyz/2025/03/06/note/fpga-kai-fa-gong-ju-lian/</a></p>
<h1 id="day2-hello-world-and-？"><a href="#day2-hello-world-and-？" class="headerlink" title="day2 hello world and ？"></a>day2 hello world and ？</h1><h2 id="LED闪灯"><a href="#LED闪灯" class="headerlink" title="LED闪灯"></a>LED闪灯</h2><p>这里主要是熟悉下新建工程，怎么用vivado</p>
<p>这IDE其实还挺像人的…就选芯片型号然后加.v文件就行了</p>
<p>代码没啥可说的，就计数器</p>
<p>这里的综合和实现（是叫这个吗？）有啥区别，没搞懂</p>
<p>只知道必须先综合然后跑实现</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503302009142.png" alt="image-20250330200905124"></p>
<p>让我们问下大d老师</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503302011790.png" alt="image-20250330201135769"></p>
<p>综合完了就能看原理图了</p>
<p>闪个灯这么一坨东西？</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503302012888.png" alt="image-20250330201221831"></p>
<p>然后做管脚约束，原理图里有两个LED，接一个（W13）</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503302014237.png" alt="image-20250330201446217"></p>
<p>时钟输入接晶振（N18）</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503302015557.png" alt="image-20250330201503537"></p>
<p>因为所有的IO都是3.3V供电，所以这里都选LVCMOS33。改一下约束然后点保存</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503302021459.png" alt="image-20250330202155395"></p>
<p>其实约束文件长这样，也可以手写（大概</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503302022426.png" alt="image-20250330202237404"></p>
<p>理论上还应该有时序约束。但是这个工程太简单先懒得管了</p>
<p>然后再综合，实现，生成bit流（好慢。。这么点工程这么慢。。）</p>
<p>自动连接然后右键program device</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503302111247.png" alt="image-20250330211142199"></p>
<p>这里遇到了问题，给我报错Launch Error: Unable to launch local hw_server executable.</p>
<p>本来以为是下载器固件或者驱动有问题，折腾了半天</p>
<p>最后其实是win的防火墙把vivado的调试器服务拦了，重启电脑然后重新开vivado,允许访问网络就ok了</p>
<p>ok，闪灯了</p>
<p>就这样</p>
<p>看起来只用fpga其实也不用配arm那边的东西就是（但是这样没法固化引导，掉电就没了，据我所知如果要引导还算必须依赖ps那边的）</p>
<p>总之算是熟悉了一遍工作流吧。软件界面，创建工程，写代码，约束引脚，综合，下载。</p>
<p>先这样。</p>
<p>todo：</p>
<p>仿真，在线调试，固化程序。</p>
<p>ps：发现矿板上的美光内存可以用官网的这个工具从丝印查到型号</p>
<p><a href="https://www.micron.com/sales-support/design-tools/fbga-parts-decoder">https://www.micron.com/sales-support/design-tools/fbga-parts-decoder</a></p>
<p>我这个D9PTK似乎是MT41K128M16JT-125这玩意 也就是256M的16bit DDR3内存</p>
<h1 id="day3-PS端-AXI-GPIO闪灯"><a href="#day3-PS端-AXI-GPIO闪灯" class="headerlink" title="day3 PS端 AXI GPIO闪灯"></a>day3 PS端 AXI GPIO闪灯</h1><p>然后熟悉下ps是吧</p>
<p>其实正常来说是应该用mio的控制吧。。这教程咋上来就用axi总线的gpio ip核了</p>
<p>算了试试也行</p>
<p><a href="http://www.hellofpga.com/index.php/2021/08/02/zynq_ps_to_pl_led_test/">http://www.hellofpga.com/index.php/2021/08/02/zynq_ps_to_pl_led_test/</a></p>
<p>复杂一点 照着做也就好了</p>
<p>也算是熟悉一下开发流程</p>
<p>有几个点吧…</p>
<p>这个vivado sdk（ps的开发工具，应该是个eclipse）里面按Ctrl+s保存代码会自动重新编译（</p>
<p>然后就是这个例程</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202504010131899.png" alt="image-20250401013120870"></p>
<p>他这个write函数是 直接写入IO的状态寄存器，也就是你写对应位是0就是输出低，对应位是1是输出高。</p>
<p>并不是按照mask给对应位置高，0的位不操作…</p>
<p>他这个例程也是有点误导性，下面是个clear，我还以为一个是置位一个是复位</p>
<p>实际上clear确实是对mask标志的位进行复位（写0）</p>
<p>但是write不是只对mask对应位写1啊….他会把其他位也写进去啊…</p>
<p>结果发现另一个led也被操作了</p>
<p>折腾半天没明白为啥会这样（我的bit0和bit1分别是一个led）</p>
<p>所以你要想只操作bit0，就要手动把bit1的状态也写上保证不会被误操作（因为我led是低点亮。。。）</p>
<p>好吧怪我没读api手册照着例程断章取义咯（</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202504010143135.png" alt="image-20250401014352108"></p>
<p>好吧大d老师nb。。。竟然有专用的函数（</p>
<p>ps：关于address editior怎么开</p>
<p>在block design里找window菜单里面有</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202504011612161.png" alt="image-20250401161225085"></p>
<h1 id="day4-PS-GPIO方法2（EMIO）-程序固化"><a href="#day4-PS-GPIO方法2（EMIO）-程序固化" class="headerlink" title="day4 PS GPIO方法2（EMIO） 程序固化"></a>day4 PS GPIO方法2（EMIO） 程序固化</h1><p>MIO或者EMIO其实是比较正常的GPIO用法吧…</p>
<p>MIO是固定的PS IO</p>
<p>EMIO就是用PL做IO的mux，随便定义IO接在哪个pin</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202504011653373.png" alt="image-20250401165313332"></p>
<p>所以MIO的IO号是0~53，EMIO的号是54~117</p>
<p>这里是AXI的GPIO和EMIO的区别</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202504011735759.png" alt="image-20250401173513731"></p>
<p>这篇文章不错：<a href="https://adaptivesupport.amd.com/s/article/1012484?language=zh_CN">https://adaptivesupport.amd.com/s/article/1012484?language=zh_CN</a></p>
<h2 id="程序固化"><a href="#程序固化" class="headerlink" title="程序固化"></a>程序固化</h2><p>zynq的程序固化必须依赖ps（从ps的fsbl也就是主boot loader引导再加载bit文件）</p>
<p>所以必须建一个fsbl工程</p>
<p>然后就是实测必须改nand的时序参数（可能是矿板这块8位nand的特殊吧）不然能烧录但是没法引导起来</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202504020059932.png" alt="img"></p>
<p>ps：改完vivado的配置之后，需要重新综合，实现，生成bit流，导出硬件描述文件，开sdk，重新编译。。</p>
<p>第一次开sdk好像还可能挂，还得重开一遍</p>
<p>总之是相当的麻烦</p>
<p>难道ps和pl联调时候pl改一点都得这么鼓捣一遍吗（干</p>
<p>还有就是下载的话必须先跳线到jtag模式，烧录，然后再关机，跳线到nand模式，再开机…不进jtag模式还没法烧录。难绷。。。</p>
<p>pss：小寄巧</p>
<p>这个向导好像也可以用来创建管脚约束（另一个方法是综合完开sch然后点那些io，在下面的边栏选按结构显示，然后一个个改）</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202504020118337.png" alt="image-20250402011845280"></p>
<p><strong>这个办法可以更快自动生成boot（不用手动去加三个文件）</strong></p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202504020119757.png" alt="image-20250402011951733"></p>
<p>todo：</p>
<p>sd卡启动，网卡</p>
<h1 id="day5-sd卡启动-uart-工程结构和添加verilog文件"><a href="#day5-sd卡启动-uart-工程结构和添加verilog文件" class="headerlink" title="day5 sd卡启动 uart 工程结构和添加verilog文件"></a>day5 sd卡启动 uart 工程结构和添加verilog文件</h1><p>先说下sd卡启动</p>
<p>其实没啥可说的</p>
<p>我折腾了一晚上纯粹是因为sd卡不兼容 两个看着一样的卡，就是有一个不能用…</p>
<p>鼓捣了半天boot模式，外设配置啥的</p>
<p>另外必须用MIO40~45这一组SD接口去启动，格式化成fat32</p>
<p>串口，也没啥可说的，默认的波特率是115200。默认用哪个串口print可以在这里直接改（如果你有两个串口）</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202504022316294.png" alt="image-20250402231629262"></p>
<p>他几个print xil_print和printf，标准的printf是支持的功能最全的。</p>
<p>如果你用printf，其实可以不用写初始化函数啥的，自动都给你做好了</p>
<p>但是如果你要调用他的底层函数，配中断啥的，那还得初始化一遍就是了。</p>
<p>然后我就突然想看下这vivado生成出来的是个什么东西</p>
<p>深坑似海啊…</p>
<p>首先他自动生成的顶层模块，这里面的暴露的接口就是在约束文件里写的接口</p>
<p>连接到下一层（也就是block design那一层）</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202504022327214.png" alt="image-20250402232725169"></p>
<p>然后这个design1就是block design生成的verilog文件</p>
<p>里面把上一层的模块连接到ps核里</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202504022329874.png" alt="image-20250402232918830"></p>
<p>这个就是ps核的例化</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202504022329969.png" alt="image-20250402232947937"></p>
<p>再下层，里面都是ps核里的axi什么乱七八糟的描述，看不懂，不看了</p>
<p>总之大概是这么个层次吧。</p>
<p>那么我们知道，zynq是没法单独启动pl（fpga部分）的，必须用ps引导pl</p>
<p>所以我直接开个.v文件，写点自己的逻辑，然后综合进去，像day2那样，是可以跑，但是没法固化，只能用编译器下载到内存里（只能调试用）</p>
<p>如果想要启动，就必须加一个ps核，然后用ps的启动镜像（包含fsbl）来引导加载pl的bitstream文件</p>
<p>于是我就想，如果我ps不做事，只用来引导pl，我的pl怎么做呢？</p>
<p>首先必须用block design建立一个ps核，然后配好ddr和nand（或者sd卡），这还是跑不掉，不然fsbl引导不了，下面的都走不下去。</p>
<p>然后直接把.v添加到工程里，再给拖进block design里…然后手动给这个模块的输入输出端口右键make external创建连接，然后综合，添加约束…这样竟然是ok的（（（（</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202504030119659.png" alt="image-20250403011950624"></p>
<p>于是他就变成了这样，ps和pl没什么关系，但是是可以这么跑的…</p>
<p>原来zynq是这种奇妙的结构吗…真是绝了</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202504030121488.png" alt="image-20250403012112469"></p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202504030121773.png" alt="image-20250403012122749"></p>
<p>然后我们发现vivado自动生成了一大堆东西，把这个加进去的模块给放在了整个顶层设计里，并且引出端口…</p>
<p>真奇妙啊，zynq</p>
<p>todo：</p>
<ul>
<li>串口中断接收</li>
<li>网口测试</li>
</ul>
]]></content>
      <tags>
        <tag>软件</tag>
        <tag>嵌入式</tag>
      </tags>
  </entry>
  <entry>
    <title>2022最新hexo+Github Pages个人博客配置全攻略！</title>
    <url>/2022/02/18/hexo%E5%8D%9A%E5%AE%A2%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<p>看朋友们都做了自己的blog，所以心血来潮学一下也来做一个…虽然不一定会经常写，但是先做了再说</p>
<p>作为第一篇文章把整个搭建配置过程的坑什么的记录一下</p>
<p>也正好作为网站的测试了</p>
<p>为了省事直接用了GitHub pages和hexo的静态方案，虽然我自己有服务器，但是用经典的wp的话主题啊插件啊各种配置啊实在是麻烦的要死而且发文章也并不方便…还是得在本地用md写完了再去网站上上传</p>
<p>干脆直接用免费的GitHub pages，然后解析到自己的域名，效果是一样的，GitHub的服务器免费还稳定，又不用担心忘了续费文章丢掉，写文也只需要在本地写完之后用一句命令部署到GitHub就可以自动更新了，倒也挺方便</p>
<p>至于md的本地写作和图片的图床之类的问题，说起来就是另一个要解决的事了，之后再写文总结一下吧…总之来回来去踩了一堆坑看了一万篇文章试了各种办法，总算是找到了比较方便的写文章+配图+上传的方法了（但是以后会多写吗？大概还是…懒癌没得救 pia~</p>
<p>总之我最后的整套方案是这样，本地用typora写文章，图片用picGo做自动处理，阿里云oss做图床储存，可以直接复制图片或者截图，然后在typora里粘贴图片，自动上传到图床并且替换图片链接，然后写完之后用hexo命令一键部署到GitHub pages就ok啦…总的来说还是比较方便的</p>
<p>目前感觉不方便的地方就是新建文章还是需要用命令，然后写完之后还得敲命令部署上传…理论上可以用脚本解决，不过typora好像并不支持插件脚本之类的功能…之后再说啦</p>
<p>网上查到的各种hexo的配置攻略版本新老不一，经常有一些新版本修改了的地方，所以也是遇到了不少麻烦，包括官方的文档好像也有一些更新不及时的地方…总归自己最后实际使用的可以工作的配置都列了出来，希望能作为参考吧</p>
<p>那么这里的日期是2022年2月…这样</p>
<span id="more"></span>
<h1 id="安装Node-js-Git"><a href="#安装Node-js-Git" class="headerlink" title="安装Node.js,Git"></a>安装Node.js,Git</h1><p>这部分比较简单 官网下载安装就好了</p>
<p>然后配置一下Git的账户和自己的GitHub账号关联（上传GitHub的ssh密钥）</p>
<p><img src="https://raw.githubusercontent.com/SuperHostPopo/MyIMG/main/img/202202172054165.png" alt="image-20220217205417118"></p>
<p>测试一下安装情况</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git version</span><br><span class="line">node -v</span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure>
<h1 id="安装Hexo框架"><a href="#安装Hexo框架" class="headerlink" title="安装Hexo框架"></a>安装Hexo框架</h1><p>直接用</p>
<p><code>npm install -g hexo-cli</code></p>
<p>（npm最好挂梯子 我这里用了clash的TUN模式全局规则代理 不然源很慢 或者你也可以把npm的源换成国内源）</p>
<p><img src="https://raw.githubusercontent.com/SuperHostPopo/MyIMG/main/img/202202172058745.png" alt=""></p>
<p>（请无视这里的npm更新提示）</p>
<p>然后初始化我们的网页</p>
<p>创建一个网站的目录，cd过去，打开命令行，执行</p>
<p><code>hexo init myBlog</code></p>
<p>这里会从hexo的GitHub上下载代码文件 所以比较慢 和刚才一样 最好挂代理</p>
<p><img src="https://raw.githubusercontent.com/SuperHostPopo/MyIMG/main/img/202202172102227.png" alt="image-20220217210217187"></p>
<p>初始化完成，这里我的文件夹就叫MyBlog</p>
<p><img src="https://raw.githubusercontent.com/SuperHostPopo/MyIMG/main/img/202202172102353.png" alt="image-20220217210252332"></p>
<p>进去看一下 已经自动生成了hexo的文件结构</p>
<p>然后cd进MyBlog这个文件夹，执行一下（不进入网站文件夹直接执行是没法启动的）</p>
<p><code>hexo s</code></p>
<p>这句代码是在本地启动服务器预览网站 Windows防火墙会跳联网提示，记得通过</p>
<p>然后进浏览器访问localhost:4000就可以看到初始化的hexo页面啦（没加主题，很丑2333）</p>
<p><img src="https://raw.githubusercontent.com/SuperHostPopo/MyIMG/main/img/202202172105546.png" alt="image-20220217210548359"></p>
<p>好了我们测试完按Ctrl+C退出来把本地服务器关掉</p>
<p><img src="https://raw.githubusercontent.com/SuperHostPopo/MyIMG/main/img/202202172107794.png" alt="image-20220217210706763"></p>
<h1 id="配置GitHub-Pages"><a href="#配置GitHub-Pages" class="headerlink" title="配置GitHub Pages"></a>配置GitHub Pages</h1><p>然后把blog部署到github上</p>
<p>创建一个新的仓库</p>
<p><img src="https://raw.githubusercontent.com/SuperHostPopo/MyIMG/main/img/202202172249059.png" alt="image-20220217224945020"></p>
<p>名字：用户名.github.io 类型公开</p>
<p><img src="https://raw.githubusercontent.com/SuperHostPopo/MyIMG/main/img/202202172251597.png" alt="image-20220217225111528"></p>
<p>看一下设置下面的pages页 当前使用的分支是main 没有问题</p>
<p>然后安装下hexo的github部署插件</p>
<p>还是在刚才hexo项目的目录下面执行</p>
<p><code>npm install hexo-deployer-git --save</code></p>
<p><img src="https://raw.githubusercontent.com/SuperHostPopo/MyIMG/main/img/202202172253818.png" alt="image-20220217225314799"></p>
<p>然后修改下目录下面的_config.yml文件 这个就是hexo全局的配置文件啦</p>
<p>先改下最基础的GitHub部署设置 网站设置和主题插件啥的之后再说</p>
<p><img src="https://raw.githubusercontent.com/SuperHostPopo/MyIMG/main/img/202202172256674.png" alt="image-20220217225604655"></p>
<p>拉到最下面 加上这些内容</p>
<p>branch就是刚才设置页面里面的分支（以前的默认都是master 但是现在GitHub的默认分支改成了main，所以这里也要填main…）</p>
<p>中间那个地址就是刚才创建的GitHub仓库的地址 这里应该是用https格式的和ssh格式的都可以</p>
<p>但是我发现用ssh链接的话我的代理似乎不能很好的运作…所以push会失败 于是改成用https格式之后部署成功</p>
<p><img src="https://raw.githubusercontent.com/SuperHostPopo/MyIMG/main/img/202202172312712.png" alt="image-20220217231228688"></p>
<p><img src="https://raw.githubusercontent.com/SuperHostPopo/MyIMG/main/img/202202172258859.png" alt="image-20220217225822828"></p>
<p>链接在仓库主页面的code下面点ssh或者https然后直接复制就可以</p>
<p>然后我们保存配置文件</p>
<p>部署应该就配置好了</p>
<p>运行一下试试</p>
<p><code>hexo g -d</code></p>
<p>这个命令是二合一指令，g是generate，意思是生成静态页面（用来上传到GitHub pages用来访问）然后-d是deploy自动部署到GitHub仓库中</p>
<p>上传成功~</p>
<p><img src="https://raw.githubusercontent.com/SuperHostPopo/MyIMG/main/img/202202172313935.png" alt="image-20220217231308902"></p>
<p>然后我们回到GitHub的仓库页面刷新一下 就可以看到网站文件被上传上去了</p>
<p><img src="https://raw.githubusercontent.com/SuperHostPopo/MyIMG/main/img/202202172313106.png" alt="image-20220217231359032"></p>
<p>浏览器输入<a href="https://superhostpopo.github.io/尝试访问一下">https://superhostpopo.github.io/尝试访问一下</a></p>
<p>ok，已经能够正常访问啦</p>
<p>那么最后再把这个页面和我的个人域名做一下解析，就可以用自己的域名访问网站啦</p>
<h1 id="解析个人域名"><a href="#解析个人域名" class="headerlink" title="解析个人域名"></a>解析个人域名</h1><p>这里我的域名在腾讯云购买的，所以进入腾讯云控制台，找到dns设置</p>
<p><img src="https://raw.githubusercontent.com/SuperHostPopo/MyIMG/main/img/202202172318134.png" alt="image-20220217231824116"></p>
<p>直接添加一条CNAME类型的记录，这里我是解析到了主域名下面的二级域名，也就是blog.superhostpopo.cn</p>
<p>所以主机记录写的blog 记录值当然是指向我们的GitHub pages的链接</p>
<p><img src="https://raw.githubusercontent.com/SuperHostPopo/MyIMG/main/img/202202172319272.png" alt="image-20220217231943252"></p>
<p>如果要使用主域名的话可以直接添加www主机名和@主机名的解析都指向GitHub pages页面即可</p>
<p>设置完dns解析，接下来要设置GitHub的页面设置把网址指向自己的域名，这里再进入settings页面，直接修改custom domain里面填入我们的个人域名然后save保存</p>
<p><img src="https://raw.githubusercontent.com/SuperHostPopo/MyIMG/main/img/202202172322292.png" alt="image-20220217232248248"></p>
<p>我这里把下面的强制https也打开了，这样访问时候都会使用https链接进行</p>
<p>看到绿色的小箭头，说明域名指向已经成功了</p>
<p>试试在浏览器里输入<a href="https://blog.superhostpopo.cn/，也可以成功访问了">https://blog.superhostpopo.cn/，也可以成功访问了</a></p>
<p>但这里还有个小问题，也就是实际上这个设置，是自动在仓库文件里加入了一个CNAME文件说明了实际网址的指向，但当我们使用hexo g -d重新部署的时候，本地文件会覆盖GitHub仓库，导致cname文件失效，所以我们要把这个文件加入到本地hexo项目的source目录下面，这样在hexo重新生成和部署的时候也会照常将这个文件上传进来</p>
<p><img src="https://raw.githubusercontent.com/SuperHostPopo/MyIMG/main/img/202202172326904.png" alt="image-20220217232619877"></p>
<p><img src="https://raw.githubusercontent.com/SuperHostPopo/MyIMG/main/img/202202172328652.png" alt="image-20220217232847609"></p>
<p>直接把这个文件下载保存在source目录下，或者在目录下直接新建一个CNAME文件，里面填上我们的个人域名地址，都是ok的，这样再次部署的时候就不会丢失cname了</p>
<p><img src="https://raw.githubusercontent.com/SuperHostPopo/MyIMG/main/img/202202172330261.png" alt="image-20220217233048241"></p>
<p>这文件里的内容很简单 只有一行</p>
<h1 id="测试新建文章"><a href="#测试新建文章" class="headerlink" title="测试新建文章"></a>测试新建文章</h1><p>写一篇文章测试一下</p>
<p><code>hexo n &quot;测试文章&quot;</code></p>
<p><img src="https://raw.githubusercontent.com/SuperHostPopo/MyIMG/main/img/202202172332545.png" alt="image-20220217233250525"></p>
<p>会自动在post目录下生成文章的md文件 然后就可以在里面加入内容啦</p>
<p>保存一下，然后还是生成上传</p>
<p><code>hexo g -d</code></p>
<p>嗯…等了一会就能看到文章啦 不过好丑（</p>
<p>PS：发现偷懒用GitHub图床的话不爬梯的话看不到图。。GitHub虽然能访问但是GitHub的图片文件就不行 奇奇怪怪的</p>
<p>算了 明天换阿里云吧 也不省这点钱了</p>
<p>PPS：尝试了下网上说的<a href="https://cdn.jsdelivr.net加速">https://cdn.jsdelivr.net加速</a> 然后发现这破玩意也得爬梯…这有个什么用啊（摔 反而更不稳定了</p>
<p>果然还是用阿里云吧</p>
<p>但是总之网站是部署成功啦 剩下的明天再研究了 摸了</p>
<h1 id="配置主题"><a href="#配置主题" class="headerlink" title="配置主题"></a>配置主题</h1><p>氪了点金（9快qwq）换了阿里云oss的图床</p>
<p>速度快的飞起</p>
<p>然后开始配主题</p>
<p>用的是GitHub上star最多的Next主题</p>
<p>文档写的也很详细：</p>
<p><a href="http://theme-next.iissnan.com/getting-started.html">http://theme-next.iissnan.com/getting-started.html</a></p>
<p>这里直接用git安装</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202202181548371.png" alt="image-20220218154803339"></p>
<p>直接进入网站目录执行这句</p>
<p><code>git clone https://github.com/iissnan/hexo-theme-next themes/next</code></p>
<p>编辑：</p>
<p>草死 这个文档上写的是老版的next的库 next已经迁移到了新版仓库 这里</p>
<p><a href="https://github.com/theme-next/hexo-theme-next">https://github.com/theme-next/hexo-theme-next</a></p>
<p>命令要用这个</p>
<p><code>git clone https://github.com/theme-next/hexo-theme-next themes/next</code></p>
<p>部署的时候才发现提示了一下已经迁移了…喂作者更新一下文档啦！</p>
<p>然后再编辑根目录的config.yml文件</p>
<p>把theme改成next就启用主题啦</p>
<p>然后看一下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g -d</span><br></pre></td></tr></table></figure>
<p>然后刷新一下发现首页只有乱码了啥也没有…</p>
<p>明明试了下<code>hexo s</code>本地看是可以正常显示的…</p>
<p>翻了下配置文件，发现原来是没有改网站域名…导致访问不到正确的文件了</p>
<p>改成自己的域名，再clean然后部署一遍，ok~</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202202181601323.png" alt="image-20220218160119297"></p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202202181601410.png" alt="image-20220218160145161"></p>
<p>主题很漂亮嘛~</p>
<p><strong>然后再做一些细节的主题配置，自己的信息什么的啦</strong></p>
<p>简单的网站信息设置，不细说了</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202202181651763.png" alt="image-20220218165134738"></p>
<p>坑：</p>
<p>首先这里语言的问题</p>
<p>按照文档上写的把语言改成zh-Hans（简体中文）</p>
<p>然后发现更新之后语言变的乱七八糟了…草（三声</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202202181624145.png" alt="image-20220218162440121"></p>
<p>去网上搜了一下发现…这是个常见问题，原因是…虽然作者在文档里写的都是zh-Hans，但是主题的目录下的语言文件却是zh-CN，所以找不到匹配的文件名自然就乱套啦</p>
<p>所以我们进入\themes\next\languages目录下面，把zh-CN.yml的文件复制一份然后改名叫zh-Hans.yml，ok~</p>
<p>（作者更新一下文档啊喂！！ x2）</p>
<p><strong>然后改一下网站的logo图标</strong></p>
<p>我们先做好180x180，32x32和16x16分辨率的图标，我在网上查到的教程都说要用ico格式的图标，但是这里其实直接用png格式就可以了，hexo默认的图标也是png的，直接用ps做出来就好了，存到\themes\next\source\images文件夹下面</p>
<p>改下\themes\next_config.yml配置文件（这个是主题配置，虽然文件名一样，但是和网站配置是不一样的）</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202202181645670.png" alt="image-20220218164535644"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">favicon:</span><br><span class="line">  small: /images/popo2-16x16.png</span><br><span class="line">  medium: /images/popo2-32x32.png</span><br><span class="line">  apple_touch_icon: /images/popo2.png</span><br></pre></td></tr></table></figure>
<p>分别修改这三个图片文件就好了</p>
<p><strong>主题的布局：</strong></p>
<p>Next主题本身内置有三个子风格，可以用在主题配置里切换</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202202181712124.png" alt="image-20220218171216101"></p>
<p>我个人比较喜欢比较简洁的这个啦</p>
<p><strong>侧边栏的头像：</strong></p>
<p>主题配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># Sidebar Avatar</span><br><span class="line">avatar:</span><br><span class="line">  # Replace the default image and set the url here.</span><br><span class="line">  url: /images/popo.png</span><br><span class="line">  # If true, the avatar will be dispalyed in circle.</span><br><span class="line">  rounded: true</span><br><span class="line">  # If true, the avatar will be rotated with the cursor.</span><br><span class="line">  rotated: false</span><br></pre></td></tr></table></figure>
<p>把url改成头像文件就行了，这里把头像显示改成了圆形的</p>
<p><strong>添加阅读量统计功能：</strong></p>
<p>感谢下@不蒜子 大佬提供的统计api功能啦</p>
<p>用起来很简单，在主题配置文件里找到这句</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">busuanzi_count:</span><br><span class="line">  enable: true</span><br></pre></td></tr></table></figure>
<p>不需要任何配置，改成true，启用即可，真的非常的简单</p>
<p>（查了一下其他各种网站提供的统计api真的是…一个比一个复杂，需要各种注册各种绑定id。麻烦死啦。dalao的api只需要一个开关就可以提供统计了，真的很感谢，太厉害啦）</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202202181725782.png" alt="image-20220218172500760"></p>
<p>效果也很不错嘛</p>
<p><strong>加入本地搜索：</strong></p>
<p>安装插件</p>
<p><code>npm install hexo-generator-searchdb --save</code></p>
<p>编辑网站配置文件，加入下面这段在最后</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">search:</span><br><span class="line">  path: search.xml</span><br><span class="line">  field: post</span><br><span class="line">  format: html</span><br><span class="line">  limit: 10000</span><br></pre></td></tr></table></figure>
<p>编辑主题配置文件，搜索这句配置打开</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># Local search</span><br><span class="line">local_search:</span><br><span class="line">  enable: true</span><br></pre></td></tr></table></figure>
<p><strong>加入latex公式支持：</strong></p>
<p>这真的是个大坑…坑了我好半天。查了各种资料 总算成功了</p>
<p>首先吧我们编辑主题配置文件，打开mathjax选项</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mathjax:</span><br><span class="line">  enable: true</span><br><span class="line">  # See: https://mhchem.github.io/MathJax-mhchem/</span><br><span class="line">  mhchem: false</span><br></pre></td></tr></table></figure>
<p>然后默认的渲染器并不能支持mathjax，所以卸载然后替换成另一个兼容的渲染器</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm uninstall hexo-renderer-marked --save</span><br><span class="line">npm install hexo-renderer-kramed --save</span><br></pre></td></tr></table></figure>
<p>最后还得在编写的文章的头部加上math支持的开关</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202202181805704.png" alt="image-20220218180538675"></p>
<p>然后重新部署运行下，总算可以正常显示latex公式啦~</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202202181806545.png" alt="image-20220218180604350"></p>
<p>关于其中的坑啊…首先配置文件里面有好几个mathjax的选项卡，但是只有math:下面的那个的enable才是有用的，别改错了</p>
<p>然后网上的支持渲染器有很多，如果用mathjax的话，就是hexo-renderer-kramed或者hexo-renderer-pandoc，但是后者我用起来会报错，前者是可以成功的</p>
<p>至于如果你用katex的话，需要选择其他的渲染器，这里我mathjax好不容易调成功了就不费劲去改其他的了所以不管了</p>
<p>最后记得在文章里打开公式支持…哎，一言难尽啊</p>
<p><strong>安装字数统计：</strong></p>
<p>安装插件</p>
<p><code>npm install hexo-symbols-count-time --save</code></p>
<p>修改站点配置文件添加</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 文章字数统计</span><br><span class="line">symbols_count_time:</span><br><span class="line">  symbols: true</span><br><span class="line">  time: true</span><br><span class="line">  total_symbols: true</span><br><span class="line">  total_time: true</span><br></pre></td></tr></table></figure>
<p>修改主题配置文件打开</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">symbols_count_time:</span><br><span class="line">  separated_meta: true</span><br><span class="line">  item_text_post: true</span><br><span class="line">  item_text_total: true</span><br></pre></td></tr></table></figure>
<p>ok啦可以看到阅读时长和文章字数</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202202181821845.png" alt="image-20220218182136822"></p>
<p>ps：感觉这个阅读时长功能没个卵用…关掉，只留下了字数统计</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 文章字数统计</span><br><span class="line">symbols_count_time:</span><br><span class="line">  symbols: true</span><br><span class="line">  time: true</span><br><span class="line">  total_symbols: true</span><br><span class="line">  total_time: true</span><br></pre></td></tr></table></figure>
<p><strong>配置标签和关于：</strong></p>
<p>hexo支持标签和分类两个文章分类功能…但是这俩我感觉，功能差不多，有点重复</p>
<p>所以就只开了标签，分类就不用了</p>
<p>先创建标签页面：</p>
<p><code>hexo new page tags</code></p>
<p>然后修改这个页面，在\source\tags\index.md</p>
<p>里面改成这样</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: Tags</span><br><span class="line">date: 2022-02-18 19:03:24</span><br><span class="line">type: &quot;tags&quot;</span><br><span class="line">---</span><br></pre></td></tr></table></figure>
<p>关掉保存</p>
<p>再修改主题配置里面的menu部分，直接把tag行的注释取消即可</p>
<p><code>tags: /tags/ || fa fa-tags</code></p>
<p>然后在写文章的时候只要在文章头里打上标签</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">title: 测试文章</span><br><span class="line">date: 2022-02-17 23:32:38</span><br><span class="line">tags:</span><br><span class="line">- 测试</span><br><span class="line">- 网站</span><br></pre></td></tr></table></figure>
<p>注意这里的格式：</p>
<p>短横线后面记得加空格</p>
<p>每一个tag占一行</p>
<p>一个文章可以有任意个标签</p>
<p>然后就可以在网站的标签页面里按照标签对文章分类了</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202202181925854.png" alt="image-20220218192525823"></p>
<p>然后添加关于页面</p>
<p>和标签页面相同，先创建about页面</p>
<p><code>hexo new page about</code></p>
<p>同样修改about目录下的index.md</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">title: 关于我</span><br><span class="line">date: 2022-02-18 19:03:14</span><br><span class="line">type: &quot;about&quot;</span><br><span class="line">#这里写关于正文内容</span><br></pre></td></tr></table></figure>
<p>修改主题配置文件，打开about行</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">menu:</span><br><span class="line">  home: / || fa fa-home</span><br><span class="line">  about: /about/ || fa fa-user</span><br><span class="line">  tags: /tags/ || fa fa-tags</span><br></pre></td></tr></table></figure>
<p>此时在主页点击关于就可以看到自己的关于页面了</p>
<p><strong>修改代码高亮风格：</strong></p>
<p>改成暗色模式，修改主题配置文件如下</p>
<p>顺便把一键复制代码的功能也打开</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">codeblock:</span><br><span class="line">  # Code Highlight theme</span><br><span class="line">  # Available values: normal | night | night eighties | night blue | night bright | solarized | solarized dark | galactic</span><br><span class="line">  # See: https://github.com/chriskempson/tomorrow-theme</span><br><span class="line">  highlight_theme: night</span><br><span class="line">  # Add copy button on codeblock</span><br><span class="line">  copy_button:</span><br><span class="line">    enable: true</span><br><span class="line">    # Show text copy result.</span><br><span class="line">    show_result: false</span><br><span class="line">    # Available values: default | flat | mac</span><br><span class="line">    style:</span><br></pre></td></tr></table></figure>
<p>效果不错~</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202202181946779.png" alt="image-20220218194659745"></p>
<p><strong>设置个人信息链接：</strong></p>
<p>修改主题配置social部分</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">social:</span><br><span class="line">  #GitHub: https://github.com/yourname || fab fa-github</span><br><span class="line">  #E-Mail: mailto:yourname@gmail.com || fa fa-envelope</span><br><span class="line">  #Weibo: https://weibo.com/yourname || fab fa-weibo</span><br><span class="line">  #Google: https://plus.google.com/yourname || fab fa-google</span><br><span class="line">  #Twitter: https://twitter.com/yourname || fab fa-twitter</span><br><span class="line">  #FB Page: https://www.facebook.com/yourname || fab fa-facebook</span><br><span class="line">  #StackOverflow: https://stackoverflow.com/yourname || fab fa-stack-overflow</span><br><span class="line">  #YouTube: https://youtube.com/yourname || fab fa-youtube</span><br><span class="line">  #Instagram: https://instagram.com/yourname || fab fa-instagram</span><br><span class="line">  #Skype: skype:yourname?call|chat || fab fa-skype</span><br></pre></td></tr></table></figure>
<p>自行启用对应条目即可</p>
<p>我这里设置的内容：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">social:</span><br><span class="line">  GitHub: https://github.com/SuperHostPopo || fab fa-github</span><br><span class="line">  bilibili: https://space.bilibili.com/4023159 || fab fa-bilibili</span><br></pre></td></tr></table></figure>
<p><strong>友情链接：</strong></p>
<p>修改links部分</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">links:</span><br><span class="line">  #Title: http://yoursite.com</span><br><span class="line">  e萌工作室: https://www.emoe.xyz/</span><br></pre></td></tr></table></figure>
<p>显示效果是这样的</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202202181947887.png" alt="image-20220218194759860"></p>
<p><strong>显示版权信息说明：</strong></p>
<p>修改主题配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">creative_commons:</span><br><span class="line">  license: by-nc-sa</span><br><span class="line">  sidebar: true</span><br><span class="line">  post: true</span><br><span class="line">  language:</span><br></pre></td></tr></table></figure>
<p>这是侧边栏和文章底部的版权信息，直接打开就好</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202202181948582.png" alt="image-20220218194824550"></p>
<p>follow me功能 这里我和侧边栏信息写的相同的，也可以添加你的rss订阅之类的进去</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">follow_me:</span><br><span class="line">  GitHub: https://github.com/SuperHostPopo || fab fa-github</span><br><span class="line">  bilibili: https://space.bilibili.com/4023159 || fab fa-youtube</span><br><span class="line">  #Twitter: https://twitter.com/username || fab fa-twitter</span><br><span class="line">  #Telegram: https://t.me/channel_name || fab fa-telegram</span><br><span class="line">  #WeChat: /images/wechat_channel.jpg || fab fa-weixin</span><br><span class="line">  #RSS: /atom.xml || fa fa-rss</span><br></pre></td></tr></table></figure>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202202182001445.png" alt="image-20220218200151416"></p>
<p><strong>修改网站底部footer：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">footer:</span><br><span class="line">  # Specify the date when the site was setup. If not defined, current year will be used.</span><br><span class="line">  #since: 2015</span><br><span class="line"></span><br><span class="line">  # Icon between year and copyright info.</span><br><span class="line">  icon:</span><br><span class="line">    # Icon name in Font Awesome. See: https://fontawesome.com/icons</span><br><span class="line">    name: fa fa-terminal</span><br><span class="line">    # If you want to animate the icon, set it to true.</span><br><span class="line">    animated: false</span><br><span class="line">    # Change the color of icon, using Hex Code.</span><br><span class="line">    color: &quot;#000000&quot;</span><br></pre></td></tr></table></figure>
<p>这里把底部的红色爱心图标修改了一下，感觉红心不是很好看。图标可以去这个网站找到代码<a href="https://fontawesome.com/icons">https://fontawesome.com/icons</a></p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202202182019506.png" alt="image-20220218201952480"></p>
<p>（无视那个访问量 这里因为本地预览所以抽掉了）</p>
<p><strong>侧边栏：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sidebar:</span><br><span class="line">  # Sidebar Position.</span><br><span class="line">  position: left</span><br><span class="line">  #position: right</span><br><span class="line"></span><br><span class="line">  # Manual define the sidebar width. If commented, will be default for:</span><br><span class="line">  # Muse | Mist: 320</span><br><span class="line">  # Pisces | Gemini: 240</span><br><span class="line">  #width: 300</span><br><span class="line"></span><br><span class="line">  # Sidebar Display (only for Muse | Mist), available values:</span><br><span class="line">  #  - post    expand on posts automatically. Default.</span><br><span class="line">  #  - always  expand for all pages automatically.</span><br><span class="line">  #  - hide    expand only when click on the sidebar toggle icon.</span><br><span class="line">  #  - remove  totally remove sidebar including sidebar toggle.</span><br><span class="line">  display: post</span><br></pre></td></tr></table></figure>
<p>这里可以修改显示位置（左右） 宽度 </p>
<p>还有何时显示</p>
<p>我就不改了都用了默认的</p>
<p><strong>回到顶部滚动条和阅读进度显示</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">back2top:</span><br><span class="line">  enable: true</span><br><span class="line">  # Back to top in sidebar.</span><br><span class="line">  sidebar: false</span><br><span class="line">  # Scroll percent label in b2t button.</span><br><span class="line">  scrollpercent: true</span><br></pre></td></tr></table></figure>
<p>把最后那个改成true就好</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202202182033245.png" alt="image-20220218203349221"></p>
<p>好啦…这些都在本地调试完了，我这个博客大概就算搞定了~</p>
<p>最后还是</p>
<p><code>hexo clean &amp;&amp; hexo g -d</code></p>
<p>搞定！desu</p>
]]></content>
      <tags>
        <tag>软件</tag>
      </tags>
  </entry>
  <entry>
    <title>开启vsc自带的同步功能</title>
    <url>/2022/02/20/vsc%E5%90%8C%E6%AD%A5/</url>
    <content><![CDATA[<p>好吧我才知道vsc自己有<strong>同步功能</strong>…每次重装都要自己折腾一遍配置和插件我真的是纯纯的犯傻…</p>
<p>姑且记录一下</p>
<p>好吧这有什么需要记的啊。知道了就好了</p>
<p><code>文件-首选项-打开设置同步</code></p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202202201751243.png" alt="image-20220220175151216"></p>
<p>然后登陆就ok啦</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202202201752696.png" alt="image-20220220175207675"></p>
<p>这里还是用微软账号省事一点</p>
<p>然后在打开的浏览器页面登录微软账户ok</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202202201753203.png" alt="image-20220220175324183"></p>
<p>然后再看就可以看到显示设置同步已打开啦~</p>
<p>我真傻。真的。这么简单的东西到现在才发现…我真傻</p>
]]></content>
      <tags>
        <tag>软件</tag>
        <tag>技巧</tag>
      </tags>
  </entry>
  <entry>
    <title>让你的hexo博客像OneNote笔记一样方便！全自动图床和一键部署设置</title>
    <url>/2022/02/19/%E5%9B%BE%E5%BA%8A%E5%92%8C%E8%87%AA%E5%8A%A8%E4%B8%8A%E4%BC%A0%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<p>说来这昨天配置完网站，想了想平时虽然也经常写东西，但是都是在用OneNote，最方便的就是放在副屏，随手新建一个页面，把看到的资料直接复制过去，图片直接截图粘贴在笔记里，再配上文字说明这样啦，很随意很方便的感觉…但是总归就没法拿来分享了</p>
<p>但如果要写博客的话，首先是图片必须先保存到本地，然后再上传到图床里，再复制图片的图床链接，打开md编辑器，写文章，插入图床链接的图片…写完之后还得去网站里把md文件手动上传发布…</p>
<p>啊啊想要随手截图记录一些资料和文字都要这么一大堆步骤，真的是折腾的很（真的不是在给一直懒得写文章找借口真的不是啊喂…</p>
<p>但是既然网站做都做了，已经折腾这么多了，如果之后还是嫌麻烦一直不写东西的话感觉也没啥价值了是吧…那是不是显得就很呆？于是开始到处查找怎么简化写博客的步骤…经过读了各种资料和一通折腾之后，就有了这个~</p>
<p>效果还是比较满意的啦，现在想记录点什么的话，直接按win+r调出运行，打一条new 文章名，回车，就可以直接启动typora写文章啦</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202202192041327.png" alt="image-20220219204117297"></p>
<p>文章排版什么的用typora+md其实还是蛮舒服的，图片的话可以直接用qq截图或者复制图片然后在文章内Ctrl+V粘贴就可以自动上传到图床并且即时把链接插入到文章里啦，基本上是达到了OneNote的随手笔记的效果了，而且排版还更舒服不少</p>
<p>写完之后保存文件，然后win+r，打upload回车，就可以自动把所有博客文章自动同步部署到GitHub Pages上的hexo博客网站里啦~<strong>是不是还挺方便的？</strong></p>
<p>自我感觉至少大概有个OneNote的8成功力了吧？虽然多平台同步编辑什么的还是做不到…不过无所谓啦，反正想写技术文章的时候基本也都是在工作电脑前的啦所以也没关系了吧</p>
<p>那么下面就是具体的配置过程啦~</p>
<span id="more"></span>
<h1 id="配置全自动图床（阿里云OSS）"><a href="#配置全自动图床（阿里云OSS）" class="headerlink" title="配置全自动图床（阿里云OSS）"></a>配置全自动图床（阿里云OSS）</h1><p>首先是图床这边啦。毕竟技术文章和笔记这类的东西，其实图片是最常用的，自己记笔记的时候也很常用把资料重点的部分截图然后直接贴到Onenote里保存，写文章的话也需要大量的配图讲解，而markdown写文章最麻烦的就是…图片不能保存在文章里，必须把图片上传到一个可以公开访问的云端图床里，然后再在文章里用链接引用图片，才能正常的插入图片显示…</p>
<p>于是无数的时间就浪费在了<strong>找图，存图，上传图床，复制链接，插入图片</strong>这些无聊到爆的劳动里了…真的不怪我懒啊他实在是太麻烦了啊喂！！不过毕竟md是种基于html的文章格式所以技术限制无可奈何…</p>
<p>我相信绝对不是只有我一个人觉得这么写文章实在是太痛苦了，我相信偷懒促进技术发展虽然我做不出但是肯定有dalao能优雅的解决这个问题…于是经过各种搜索，果然我找到了这个…一个叫<strong>PicGo</strong>的全自动图床工具~<br><strong><a href="https://github.com/Molunerfinn/PicGo"> PicGo</a></strong>这里是这个工具的GitHub链接，我们搬一下官方的介绍</p>
<blockquote>
<p><strong>PicGo: 一个用于快速上传图片并获取图片 URL 链接的工具</strong><br>PicGo 本体支持如下图床：<br>特色功能</p>
<ul>
<li>支持拖拽图片上传</li>
<li>支持快捷键上传剪贴板里第一张图片</li>
<li>Windows 和 macOS 支持右键图片文件通过菜单上传 (v2.1.0+)</li>
<li>上传图片后自动复制链接到剪贴板</li>
<li>支持自定义复制到剪贴板的链接格式</li>
<li>支持修改快捷键，默认快速上传快捷键：<code>command+shift+p</code>（macOS）| <code>control+shift+p</code>（Windows\Linux)</li>
<li>支持插件系统，已有插件支持 Gitee、青云等第三方图床</li>
</ul>
</blockquote>
<p>完美满足需求嘛，看来果然前辈们早就感受到了md图片管理的痛苦并且做出了完美的解决方案~唯一的小问题就是这里粘贴图片还是需要先用快捷键上传图片然后再粘贴自动获取的链接插入到md，还是多了一步的小小麻烦，不是那么的丝滑</p>
<p>那有更好的解决嘛？从上面看下来那自然是找到了的，在网上查了各种教程并且实际配置之后发现typora内置的picgo上传支持可以完美的支持粘贴图片上传的功能，于是我们把PicGo和Typora配置好联合使用之后，就可以<strong>完美 丝滑 不需要任何多余步骤</strong>的 实现在markdown文档里直接Ctrl+V粘贴截图图片然后自动帮你上传修改链接配置好一切啦…一切都像在用OneNote一样，完美！</p>
<p>那么选好大框架，剩下的就只是图床的选择啦，这就是小问题了（或者说只是钱的问题了？好像完全不是小问题啊草</p>
<p>先看看PicGo，适配了常用的主流图床，所以我们自然是在以下里面选一个</p>
<ul>
<li><p><code>七牛图床</code> v1.0</p>
</li>
<li><p><code>腾讯云 COS v4\v5 版本</code> v1.1 &amp; v1.5.0</p>
</li>
<li><p><code>又拍云</code> v1.2.0</p>
</li>
<li><p><code>GitHub</code> v1.5.0</p>
</li>
<li><p><code>SM.MS V2</code> v2.3.0-beta.0</p>
</li>
<li><p><code>阿里云 OSS</code> v1.6.0</p>
</li>
<li><p><code>Imgur</code> v1.6.0</p>
</li>
</ul>
<p>为了我们的图片安全考虑，我就先排除掉了小平台专门的图床服务（其实也不一定不安全啦…很多都是老牌网站，但是其实我也是嫌麻烦而且懒得再注册新账号和研究怎么使用了就是…到底还是偷懒了）</p>
<p>那么剩下的，我挑出来的就是GitHub和阿里云了，前者是因为没有限制，可靠而且…免费啊！后者嘛阿里云平台也比较熟悉，另外好几个朋友之前都在用阿里云OSS图床写文章了，评价不错，所以优先考虑</p>
<p>秉承着能白嫖就一定要白嫖的原则，我是首先尝试了GitHub的，其实配置起来很简单，用起来效果也不错…但是毕竟不是专门的图床服务，<strong>本质上其实是用GitHub的仓库储存图片并且提供链接访问</strong></p>
<p>所以就产生了一些无法避免的槽点</p>
<ul>
<li>图传上去删不掉！因为仓库的commit历史都可以回溯！虽然可以有办法用命令行删除但是如果不小心上传了不安全的图片处理起来还是麻烦的要死！而且仓库必须全公开！</li>
<li>更麻烦的是，众所周知GitHub的内容访问在国内不稳定！必须时刻爬梯子，共享性上就很烂！</li>
</ul>
<p>这俩问题一个比一个严重…所以我还是放弃掉了GitHub图床，选择了氪金解决的阿里云OSS</p>
<p><strong>实际证明花钱的东西唯一的缺点就只有花钱了！</strong>绝赞，不管是速度还是使用体验，真的超快</p>
<p>而且其实也不会花多少钱，以我的例子来说，40G容量一年9块（够存一辈子的图片了…只存博客配图的话），再加上一点点流量费用（根本就没有人看，所以也很少呃） 使用体验还是很棒的了</p>
<p>那么写了一堆废话，实际的配置教程…其实根本不用我写，官方的文档和前辈大佬的配置教程写的详细多了，我也完全没必要再浪费一堆废话了…所以直接上链接啦</p>
<p><strong>首先是官方的配置手册</strong>，写的很详细：<a href="https://picgo.github.io/PicGo-Doc/zh/guide/config.html#%E9%98%BF%E9%87%8C%E4%BA%91oss">配置手册</a></p>
<p><strong>然后是阿里云OSS的开通和Pic Go和Typora联合使用的配置教程</strong>，这个更是手把手教学了：<a href="https://segmentfault.com/a/1190000039256231">PicGo + 阿里云OSS 搭建图床工具（附Typora设置）</a></p>
<p>至于GitHub图床的教程的话，官方配置手册里也写的很详细了，如果不在意上面说的缺点（还是想白嫖）的话可以去读一下，非常的简单，这里就不重复了</p>
<h1 id="自动新建文章和hexo部署上传"><a href="#自动新建文章和hexo部署上传" class="headerlink" title="自动新建文章和hexo部署上传"></a>自动新建文章和hexo部署上传</h1><p>图床的问题解决了</p>
<p>那么现在我们想要写一篇文章的话该怎么做呢？</p>
<p>开终端，进入本地的hexo博客目录，hexo n 文章名 新建文章，关终端，开资源管理器，进博客目录的post文件夹下，打开创建的文章的md文件，然后开始写…</p>
<p>写完之后呢？还得开终端，再进目录，再hexo clean &amp;&amp; hexo g -d把新写的文章部署上传到GitHub pages上…</p>
<p>好像还是有点麻烦是不是？我只想像OneNote一样新建，起标题，记完保存关掉就好，有没有办法呀？</p>
<p>好吧这里我没查到什么好的自动化工具，可能大佬实在还是没有我这么懒吧…</p>
<p>所以只能自己找点办法了…姑且算是解决了问题，用起来也还凑合…就是方法确实不太优雅就是了</p>
<p>嘛，毕竟我不是大佬，所以也没办法啦</p>
<p><strong>首先我们想办法简化下新建文章的步骤</strong>，这里我是直接写了个简单的bat脚本，接收一个新建文章名的参数，然后自动执行新建文章并且用typora打开文章的命令，写的很丑，但是用起来还行…长这样</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@echo off</span><br><span class="line">set type=.md</span><br><span class="line">set name=%1</span><br><span class="line">set file_name=%name%%type%</span><br><span class="line">cd /D H:\Code\MyBlog</span><br><span class="line">hexo n %1 &amp;&amp; cd .\source\_posts &amp;&amp; &quot;C:\Program Files\Typora\Typora.exe&quot; %file_name%</span><br></pre></td></tr></table></figure>
<p>然后把这个脚本存成new.bat，扔到网站根目录下面，再把网站根目录加到系统path里…这样我们就可以按win+R直接输入new 文章名 调用这个脚本自动生成文章然后打开typora开始码字啦~</p>
<p><strong>再做个一键上传的脚本</strong>，这个就更简单了，还是一个bat，只需要一句</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd /D H:\Code\MyBlog</span><br><span class="line">hexo clean &amp;&amp; hexo g -d</span><br></pre></td></tr></table></figure>
<p>这个我们存成upload.bat，也扔到网站根目录里，写完文章保存之后按win+R打下upload回车就可以自动把文章全部部署上传到网站里喽</p>
<p>嗯…好吧，我承认这么实现实在是不太优雅实在是有点丑陋，但是方便就好，不是吗，就这样吧</p>
<blockquote>
<p>其实有个比较优雅的方案是这样</p>
<p>用VSC做md编辑器的话，可以写一个插件，在侧栏做出hexo文章新建和本地文章管理的功能，用GUI简单的新建文章，然后做到编辑后自动保存和部署上传博客</p>
<p><strong>这样使用体验就完全追上OneNote啦！</strong></p>
</blockquote>
<p>听起来创意很美好不是吗？呃…但是首先typora并不支持插件功能，虽然vsc写md也不错但是双栏预览的编辑模式感觉还是没有所见即所得写起来舒服一些</p>
<p>然后嘛…我并不会vsc插件开发呀（pia~被拍飞😢）寄！而且不想折腾了，寄！</p>
<p>那么就这样吧，也还不算麻烦…不知道以后会不会有大佬做出这样的插件呢？期待一下啦</p>
<p>那么希望我以后能多写点文章吧…勤奋一点，嗯！</p>
]]></content>
      <tags>
        <tag>软件</tag>
      </tags>
  </entry>
  <entry>
    <title>lora训练学习笔记续_2024</title>
    <url>/2024/05/13/lora%E8%AE%AD%E7%BB%83%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E7%BB%AD-2024/</url>
    <content><![CDATA[<p>好久没摸了</p>
<p>快一年了技术迭代很快啊</p>
<p>已经是xl的时代了 也习惯了直接依赖模型里的人物和去c站找lora了</p>
<p>但是也会遇到冷门到模型都找不出的（悲</p>
<p>所以还是捡起来重新学一遍吧…</p>
<span id="more"></span>
<h1 id="训练集处理"><a href="#训练集处理" class="headerlink" title="训练集处理"></a>训练集处理</h1><p>啊 真的是 冷门人物就是这样</p>
<p>全网找不到几张图</p>
<p>真的是深刻感受到炼丹最难的就是数据集</p>
<p>数据集处理真是最耗时的事情</p>
<p>到处找加上视频截图啥的都算上抠了二十几张图吧。最开始随便处理了下tag然后塞进去练，出来的效果惨不忍睹</p>
<p>除了参数，感觉问题主要还是出在了 数据集的处理上</p>
<p>于是去找资料…总结几个小tips</p>
<ul>
<li><p>下载来的图片有png的jpg的各种各样，但是扔到sd-webui的后期处理里批量跑一下可以统一转换成png，不需要手动拿软件转换了</p>
</li>
<li><p>乱七八糟的数据集重命名，advanced renamer是个很好用的小软件</p>
</li>
<li><p>最好把图片处理成统一的分辨率和比例，虽然开了arb可以支持不同分辨率比例，但是会造成训练时候分组，听dalao说是不太好。我这里尝试是横图和竖图分别统一放大/裁剪成同样大小</p>
</li>
<li><p>sd-webui的后处理真的好用，可以支持自动裁剪宽高比，并且不仅可以放大还可以<strong>自动把大图裁剪、缩小</strong>，总之不管啥图扔进去出来的就是设置好的分辨率的图片了，真的非常方便</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202405130049791.png" alt="image-20240513004904657"></p>
</li>
<li><p>png不要用透明背景，如果有签名、边框、文字什么的最好ps修掉</p>
</li>
<li><p>乱七八糟的背景最好手动切掉（ps 选择主体，然后大概切一下，倒是也还简单）</p>
</li>
</ul>
<h2 id="打标"><a href="#打标" class="headerlink" title="打标"></a>打标</h2><p>老生常谈了</p>
<p>最开头加触发词。人物特征的tag删掉。非共性的可变描述tag保留 之类的这些</p>
<p>另外如果文字和边框不修掉的话要在tag里体现出来（这样最后出来的图不会有奇怪的东西）</p>
<p>打标阈值0.35什么的 不多说了都老传统</p>
<p>推荐下标签编辑的小软件</p>
<p>BooruDatasetTagManager</p>
<p>超好用 用过的都说好 还有自动翻译标签功能</p>
<p>比插件的那个编辑器好用多了</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202405130105947.png" alt="image-20240513010502901"></p>
<h1 id="训练参数什么的"><a href="#训练参数什么的" class="headerlink" title="训练参数什么的"></a>训练参数什么的</h1><p>这些都是视频的佬教的</p>
<ul>
<li>小训练集需要较大的等效的batch_size 嗯就是这两个参数相乘，因为众所周知batch size大点显存猛猛爆所以下面那个调大点可以假装自己batch size大</li>
</ul>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202405130232191.png" alt="image-20240513023220165"></p>
<p>参考秋叶的说明</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202405130233763.png" alt="image-20240513023321749"></p>
<ul>
<li><p>这两个相乘的大小推荐是图片数量的一半（因为图片repeat数推荐是1，所以每个epoch训练数量就是数据集图片数量） 也就是后面是前面2倍（我这里是6倍了）</p>
<p>为什么呢 我也不知道呢 </p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202405130236475.png" alt="image-20240513023630454"></p>
<p>所以如果保证显存不爆的情况下我可以把梯度累加步数改成3，这样后面的就变成1500了</p>
</li>
<li><p>另一个问题是arb桶，假如我设置的训练分辨率是1024x1024，所有大于这个分辨率的，或者不是1：1的图片，都会被切成方形然后变成1024x1024。</p>
<p>但是如果开了arb桶，他会按分辨率比例去分组图片，然后分开训练，这里有个问题就是分组完了之后，训练的等效batch size就变小了（每组图片少了）</p>
<p>所以我的理解是，最好就直接用sdwebui的预处理把图切成一样的分辨率完事，这样arb也不会乱分组，或者我觉得一个横向比例一个纵向比例这样分两组应该也还好？</p>
</li>
<li><p>嗯于是问题就又回到了上面的数据集预处理问题。果然训练的重点就是数据集啊。</p>
</li>
<li><p>lokr的dim值没用，随便填的。prodigy优化器的学习率啥的都没用（大概），随便填之</p>
</li>
</ul>
<p>更新：</p>
<p>嗯。。实际用我这十几张图练了一下 发现了比较明显的过拟合，出图烂掉了（很糊的那种图）</p>
<p>反复试了试也不知道是优化器的问题还是底模的问题还是训练方法问题还是我训练集太烂</p>
<p>总之是烂掉了</p>
<p>回到秋叶训练器用最传统的方法练了下，反而还好一些…（默认参数 传统adam优化器 lora算法，1batch size+5 repeat 50个epoch）真难啊</p>
<p>重新开始学习。。</p>
<p>嗯。看到个说法说这个和神童优化器会冲突 或许吧。。有空试试看吧</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202405212353286.png" alt="image-20240521235316257"></p>
<h1 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h1><p><a href="https://civitai.com/articles/3105/essential-to-advanced-guide-to-training-a-lora">https://civitai.com/articles/3105/essential-to-advanced-guide-to-training-a-lora</a></p>
<p><a href="https://www.bilibili.com/video/BV1Ru4m1g7Fo">https://www.bilibili.com/video/BV1Ru4m1g7Fo</a></p>
<p><a href="https://www.bilibili.com/video/BV1CF4m1N7PU">https://www.bilibili.com/video/BV1CF4m1N7PU</a></p>
<p>都是很棒的教程</p>
<p>另外致谢秋叶佬、青龙佬的整合包和教程</p>
]]></content>
  </entry>
  <entry>
    <title>我回来啦</title>
    <url>/2023/02/19/%E6%88%91%E5%9B%9E%E6%9D%A5%E5%95%A6/</url>
    <content><![CDATA[<p>突然想起来还做过这么个玩意（pia…</p>
<p>更新下已经落后了一年版本的hexo吧…</p>
<p>就是这样~</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/image-20230219153853928.png" alt="image-20230219153853928"></p>
]]></content>
      <tags>
        <tag>杂项</tag>
      </tags>
  </entry>
  <entry>
    <title>不当爱抖露了！星野爱的重启人生</title>
    <url>/2023/06/28/%E5%AE%89%E7%A7%91/</url>
    <content><![CDATA[<blockquote>
<p>同步更新：</p>
<p>nga：<a href="https://bbs.nga.cn/read.php?tid=36780513">https://bbs.nga.cn/read.php?tid=36780513</a></p>
<p>泥潭吞楼太厉害，搞个备份</p>
</blockquote>
<p><strong>想要与你相见，此愿我已寄托于星。</strong></p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202306280035446.png" alt="00023-397873791"></p>
<span id="more"></span>
<p>大家好~这里是个萌新，纯种的。创作经验莫得，文笔渣，中二病，逻辑乱，ooc，情商低，社畜苦，更新咕…<br>大纲无，存稿无，nga现骰现编中…打下这些字的时候正文真的一点都还没有写…<br>提前说声抱歉对不住读者老爷们的期待如果有读者的话，轻喷啦<br>如果还愿意看下去的话(真的有吗？)</p>
<p>大概是纯自嗨吧，看了推子第一集之后就一直意难平，如果有另一条世界线该多好，如果那个世界可以再温柔一点该多好。在看了最新话的兄妹相认大药之后冲动再也抑制不住了——</p>
<p><strong>我要给星野爱完整的一生！</strong></p>
<p>于是基本就是这样，想要写一个另一条路线的星野爱充满未知的新生活，大体上应该是一个轻松快乐的故事吧 严谨的故事lz这种萌新也写不来啊，没那个能力知道嘛 ，来到各种各样的地方，结识形形色色的人，参与各种各样新奇有趣的冒险什么的~</p>
<p>也会选择一个温柔的世界观，并且加足够强力的保底机制防止爱小姐的这次人生也变得惨兮兮的 lz向来是过保护的he大团圆爱好者啦</p>
<p>预计会很混沌，太严肃的内容无，可能会有漫无边际的乱入和梗选项什么的，希望能足够有趣和快乐就好了呢。<br>也欢迎各种各样乱七八糟的安价啦如果真的有人安价的话</p>
<p>因为是纯纯的萌新搞不明白怎么设计战斗系统也绝对写不好战斗，太难了啦！所以大概不会做战斗系统吧…目前吧？看我学习的成果啦，没准啥时候就觉得自己突然行了什么的</p>
<p>再一次，愿爱小姐能拥有闪耀而快乐的人生！那么开始投下。</p>
<p>如果看不到下面就是lz被抓去上班了/神鹤吞了/憋不出来卡文了 大变申</p>
<p>骰娘啊骰娘 会有观众老爷赏脸嘛？</p>
<p><strong>ROLL : 1d100</strong>=d100(93)=<strong>93</strong></p>
<blockquote>
<p>碎碎念 …</p>
<p>果然都会有的吧，那种突然涌起的想要写点什么东西的冲动，越想越兴奋越想越兴奋，看的多了创作欲就会不受控的冒出来…然后真的想做的时候发现 寄了 我怎么这么菜写不出来啊卡壳啊这写的都是些啥啊 </p>
<p>但是为什么还要作死呢。说到底还是冲动吧，想要做什么的冲动是挡不住的，明知道自己不行，明知道会失败，也想要马上去做的悸动吧。不停的踌躇害怕但是最后，还是输给了自己的欲望，不去做的话，热情冷下来的时候，就会后悔，又错过了尝试一件事的勇气，那时候没有尝试的话，以后可能就永远也不会去做了吧。</p>
<p>了解安科的时间也不长，入坑作和很多人一样都是敬爱的王子海皇，虽然是看了王子新作小说后回去补的烈幻入真的是纯纯萌新中的萌新了。<br>第一次看就被这种 不可预测的命运的舞台 深深的吸引了<br>感觉会很快乐的样子呢！那就尝试一下吧！不试试去做会后悔的吧！失败了也没什么大不了的嘛！ 嗯 反正失败的尝试已经够多啦</p>
</blockquote>
<p>在下午上班之前，先按照惯例车个卡吧 虽然好像没多大用的样子，就当是第一次的仪式感吧</p>
<p><strong>星野爱</strong><br>力量：</p>
<p><strong>ROLL : 1d100</strong>=d100(63)=<strong>63</strong></p>
<p>擅长唱跳，身体能力不错的样子<br>体质：</p>
<p><strong>ROLL : 1d100</strong>=d100(8)=<strong>8</strong></p>
<p>差点大失败…体力不差，但是体质低，是有什么罕见的疾病吗？燃烧生命在当偶像吗喂<br>智力：</p>
<p><strong>ROLL : 1d70</strong>=d70(15)=<strong>15</strong></p>
<p>(没上过学 -30)<br>爱…我的丈育…有一种纯真的美 不是 符合原作的知识水平!<br>魅力：</p>
<p><strong>ROLL : 1d100+50</strong>=d100(58)+50=<strong>108</strong></p>
<p>(天才般的爱抖露sama +50，可突破上限)<br>总算有个不拉的了<strong>这不是全靠加值么</strong><br>意志：</p>
<p><strong>ROLL : 1d100</strong>=d100(43)=<strong>43</strong></p>
<p>普普通通平凡人的感觉<br>幸运：</p>
<p><strong>ROLL : 1d100</strong>=d100(69)=<strong>69</strong></p>
<p>普通的好运，大概能捡到零钱或者靠直觉避开雨天的程度吧，但是敌不过命运的恶意<br>魔力：0[未解锁]<br>这个世界，有魔法吗？</p>
<p>lz要去上班了，下班后再见 上班摸鱼构思ing</p>
<p>晚饭小更一下…没有大失败真好啊，真好啊，好啊，啊 但是这出目<br>怎么感觉会命途多舛啊</p>
<p>下班啦 继续</p>
<p>先来骰一下为啥这么惨体质只有8<br>是身体疾病吗</p>
<p><strong>ROLL : 1d2</strong>=d2(1)=<strong>1</strong>(是/否)</p>
<p>燃烧生命歌唱的病弱少女，我哭死<br>那么是什么病呢</p>
<p><strong>ROLL : 1d10</strong>=d10(5)=<strong>5</strong></p>
<p>1-2 和莎莉奈同样的病症<br>3-4 营养不良(什么屑孤儿院)<br>5-6 严重贫血<br>7-8 遗传性心脏病(咚 咚 咚)<br>9 其实是装病(怎么都是屑啊)<br>10 大成功/大失败(<strong>ROLL : 1d2</strong>=d2(1)=<strong>1</strong>)</p>
<p>骰娘好温柔 选中了平和的选项<br>区区贫血而已，就用天才偶像大人高达43的意志力克服过去口牙<br>贫血的严重程度(越大越严重 0:多 吃 红 枣 100:临 界 血 限)</p>
<p><strong>ROLL : 1d100</strong>=d100(99)=<strong>99</strong></p>
<p>草草草<br>人生第一个大成功为什么会出现在这种地方啊<br>现在就是很后悔 非常后悔</p>
<p><strong>“不要手贱去丢感觉没什么所谓的骰子”</strong>——必可活用于下一次</p>
<p>让我冷静下想想该怎么圆…</p>
<p>明明只是想找下手感象征性的车下卡满足下中二的仪式感啊喂，为什么会变成这样呢…说好的重生呢</p>
<p>病情 大 成 功<br><strong>危</strong><br>也就是星野爱大失败<br>已经不是一般的贫血了，稍微运动过量可能就会缺氧倒地了吧。</p>
<p>带着如此的身体，却还在偶像的舞台上闪闪发光，已经是毫无疑问的在燃烧生命了吧。<br>忘我的燃烧，一瞬的闪耀，双瞳中的光芒，如夜空中的长庚星一样点亮了无数人的梦想<br>”一等星寄于你身”，名副其实的，天才般的偶像大人<br>也难怪露比和阿库亚会无可救药的被吸引吧</p>
<p>大失败是什么：</p>
<p><strong>ROLL : 1d10</strong>=d10(1)=<strong>1</strong></p>
<p>1-2 某次live过度劳累重病后被神木光趁虚而入(接 回 原 作)<br>3-4 粉丝线下开门杀时由于惊吓贫血发作而亡(世界线的收束)<br>5-6 其实神木光是活在现代的吸血鬼？<br>7-8 星野爱超人的魅力是血继限界，但代价是贫血<br>9 其实星野爱是超级混血种，血统浓度太高不稳定，表现为贫血(为啥啊)<br>10 大成功/大失败</p>
<p><strong>ROLL : 1d2</strong>=d2(1)=<strong>1</strong></p>
<p>PS：因为主题是重生，所以星野爱的死是已经发生了的事件。但是具体的情况可能会和原作有些微妙的不同？ 本来不想不同的但是骰娘果然是自由的啊…</p>
<p>感谢版主 总算放出来了<br>人类的本质就是手贱<br>lz为什么又要手贱去改主楼然后被神鹤关了小黑屋</p>
<p>后一半的梗选项没中，所以还是稳健的原作展开，唐突的大失败只是给小爱惨兮兮的一生又增加了一个注解…大概</p>
<p>让我们回到主线吧</p>
<p>小爱打了那个改变命运的电话吗</p>
<p><strong>ROLL : 1d10</strong>=d10(9)=<strong>9</strong></p>
<p>1-9 打了(原作展开)<br>10 没打(微妙的剧情变化)</p>
<p>来个骰娘小爱。愿小爱的新人生也能拥有骰娘的祝福<br><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202306280057284.jpeg" alt="img"></p>
<p>一念之差，终归，还是没有逃得开命运<br>在按下通话键之前，在想些什么呢？或许是直觉，或许是超出常人的幸运，或许是不甘于既定的结局，犹豫着，手指微微颤抖。<br>最终，还是按下了恶魔的门铃。<br>给孩子们一个惊喜吧？带着点恶作剧的想着，离开了一人间的电话亭。</p>
<p>于是那盛大的绽放和渺小的心愿都轰然崩塌。</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202306280057095.jpeg" alt="img"><br>“我爱你们。”<br>“这句话…绝对，不是谎言。”</p>
<p>说出来了啊。太好了。然后…<br>孩子撕心裂肺的哭喊声似乎逐渐模糊了。视野越来越暗。<br>天黑了吗<br>好多星星。大城市里，也能看到星空吗？<br>好亮，最亮的那一颗，是叫什么…<br>可以许愿吗？<br>好想要，“爱”啊。</p>
<p>意识，中断了。</p>
<p>“爱！” “爱！” “爱！！！”<br>……“都是，我的错”</p>
<p>爱的苏醒(75以上醒来)</p>
<p><strong>ROLL : 1d100</strong>=d100(2)=<strong>2</strong></p>
<p>唐 突 大 失 败<br>但是死都死了…放过孩子吧，已经够惨的了，只是想多睡一会有什么错 bushi</p>
<p>？？？的闹别扭(别扭：小爱你倒是争点气啊&lt;——&gt;温柔：已经很累了，多休息下吧)</p>
<p><strong>ROLL : d100</strong>=d100(52)=<strong>52</strong></p>
<p>星野爱的苏醒(75以上醒来，？？？的祝福+25)</p>
<p><strong>ROLL : d100</strong>=d100(48)=<strong>48</strong></p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202306280057885.jpeg" alt="img"></p>
<p>上一楼忘了写加值了<br>1d100(48)+25=73<br>怎么又在关键时刻差一点拉跨啊</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202306280057168.jpeg" alt="img"><br>？？？(随机立绘)：辛苦啦，真是个粪游戏呀，人生的一周目。受苦了呢，小爱，但是，要全成就通关的吧，二周目？加油！</p>
<p>星野爱的苏醒(75以上醒来，？？？的祝福+50)</p>
<p><strong>ROLL : d100+50</strong>=d100(93)+50=<strong>143</strong></p>
<p>看来鼓励很有效嘛。星野爱，堂堂复活！</p>
<p>先骰一下状态。<br>二周目小爱醒来时多大了：</p>
<p><strong>ROLL : 1d6+10</strong>=d6(5)+10=<strong>15</strong></p>
<p>(？？？：跳关是二周目的一环！孤儿院太受苦了别再折磨孩子了)</p>
<p>现在的剧情时间点是：(越小越接近被小爱被刺杀时，越大越接近推子原作进度的时间)</p>
<p><strong>ROLL : 1d100</strong>=d100(3)=<strong>3</strong></p>
<p>小爱的记忆：(0：我是谁，我在哪？ 100：仿佛从前世的梦中醒来)<br><strong>？？？的祝福：那些痛苦，已经过去了(遗忘痛苦的回忆，不会踏上一周目路线)</strong></p>
<p><strong>ROLL : 1d100</strong>=d100(95)=<strong>95</strong></p>
<p>PS：想了想，还是让不要让过去的回忆啊复仇啊神木光什么的再掺和进来了，大赤老师都写不明白我瞎整干啥啊，说好的要给小爱一个开心快乐的故事啊。</p>
<p>大失败接大成功，骰娘，令人敬畏<br>剧情时间是被刺前后，也就是小爱20岁，阿夸露比才4岁，有点遗憾可能没法很快让原作主角组们出场了。或许mem还有机会？<br>记忆大成功，基本啥都记得，就当是之前的技能点都完美继承了吧。</p>
<p>好像听到了呼唤。<br>“加油！”<br>该醒了。<br>亮光，刺眼的朝阳，睁开双眼。<br>做了个好长的梦啊…为了成为有名的偶像，努力地练习，一步步地积累人气，那一天，马上就要到了。明天，就要登上东京巨蛋演出了…好幸福…然后…<br>然后怎么了？记忆…想不起来<br>不对！<br>这不是梦！<br>我是…星野爱。<br>我应该，<strong>已经死了啊</strong></p>
<p>小爱的惊讶：</p>
<p><strong>ROLL : 1d100</strong>=d100(21)=<strong>21</strong></p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202306280058633.jpeg" alt="img"></p>
<p>lz看了新一话内心过于激动 已经不知道怎么描述了<br>我发现nga的分隔线在手机端好像不太能显示。还是手动吧</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202306280058042.jpeg" alt="img"><br>诶，难道是传说中的重生剧情？果然我是女主角嘛！</p>
<p>稍加思考，小爱就充满自信地接受了这个事实<br>至于是怎么死掉的？完全没印象，就当作是live路上救助小女孩然后堂堂泥头车转生吧！做了好事啊，这么想的话，不是大赚特赚了吗？反正女主角是不会死的啦！</p>
<p>既然是赚来的人生，这次就自由自在一点吧<br>也不用再做偶像了吧。最高峰，差一步就可以登上了。虽然很可惜，但是”谎言“已经表演的够多了。这一次，还是试一下”真实“的自己吧</p>
<p>小爱还想继续做偶像吗：(做够了，想尝试下新人生-50，也就是目前不会做啦)</p>
<p><strong>ROLL : 1d50</strong>=d50(17)=<strong>17</strong></p>
<p>说起来现在是什么情况，既然没有当偶像的话，还在孤儿院吗？(1-9 还在 10 不太一样的情况)</p>
<p><strong>ROLL : 1d10</strong>=d10(2)=<strong>2</strong></p>
<p>如果在的话，和孤儿院关系好吗？</p>
<p><strong>ROLL : 1d100</strong>=d100(87)=<strong>87</strong></p>
<p>生活条件怎么样</p>
<p><strong>ROLL : 1d100</strong>=d100(4)=<strong>4</strong></p>
<p>这大失败率是不是不正常啊喂<br>还好因为是重生来的所以只是背景板设定，小爱不用再受苦了(跳关万岁！但是按这个设定的话上辈子过的是有多倒霉啊…)</p>
<p>从小生活的孤儿院，虽然条件不太好，但是孤儿院老奶奶却对孩子们都很用心照顾。对小爱来说，这里是比那个在两世记忆中都没有留下几个片段的”家庭“要温暖的多的地方了。<br><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202306280058010.jpeg" alt="img"><br>”总比挨那个不知道现在出没出狱的老妈揍强多了嘛！”<br>小爱总是一边笑一边这么说。<br>虽说孤儿院的生活还算温馨，但是物质条件上…<br>大失败：</p>
<p><strong>ROLL : 1d10</strong>=d10(2)=<strong>2</strong></p>
<p>1-3 穷困潦倒，乡下孤儿院资助企业倒闭，已经快要维持不下去了<br>4-6 家徒四壁，夏天漏雨冬天挨冻<br>7-9 吃不饱饭，年长的姐姐都会把饭菜让给长身体的小爱一些<br>10 大成功/大失败</p>
<p><strong>ROLL : 1d2</strong>=d2(1)=<strong>1</strong></p>
<p>吞楼好严重 可能还是得找个备份更新的地方了…让我找找<br>————————————<br>倒闭边缘的孤儿院，很王道系的开局</p>
<p>真怀念啊，这个地方。躺在熟悉的床上，小爱感受到了久违的温暖和放松<br>上一次，也是为了赚钱，才一个人跑到大城市，走上了偶像之路</p>
<p>“那就再来一次吧，加油！我可是王道系女主角，换一个路线一定也可以的！”<br>拍了拍自己的脸颊，小爱站起身，走出了“存档点”</p>
<p>要去哪里呢：(1 先在乡下转转 2 出发，去大城市！)</p>
<p><strong>ROLL : 1d2</strong>=d2(1)=<strong>1</strong></p>
<p>顺便一提，重生清除病弱debuff，现在的小爱，感觉自己无敌青春健康，状态好极了<br>重骰下体质，保底60(健康青春少女)</p>
<p><strong>ROLL : 1d100</strong>=d100(63)=<strong>63</strong></p>
<p>智力因为还是并没有上学所以很遗憾…(教育程度低是萌点！)</p>
<p>曾经无比憧憬的大城市，也早已失去了光鲜亮丽的滤镜。曾经的超人气偶像，这一世也还只是一个普普通通初中年级的少女而已。</p>
<p>“真的没人认得自己了啊…不过这地方本来也没人认得什么偶像吧？”<br>走在清晨的小路上，下意识地做出了招牌的微笑，随即，又恍然一愣<br>“不用伪装自己，不用营业的笑容，这样的感觉，也不坏嘛”<br>小爱自嘲地想着<br>“毕竟，我已经不是偶像了嘛”</p>
<p>“总之，女主角就先来拯救这个家吧！”<br>说是这么说…该做点啥呢？</p>
<p>小爱的决心：(像家一样的存在+30)</p>
<p><strong>ROLL : 1d70+30</strong>=d70(32)+30=<strong>62</strong></p>
<p>小爱思路的正经程度：(越大越正经，越小越脱线)</p>
<p><strong>ROLL : 1d100</strong>=d100(26)=<strong>26</strong></p>
<p>————————————<br>新手村任务：第一桶金！为了拯救即将废部的…</p>
<p>还指望她能想出啥靠谱的主意  只能说符合原作了<br>————————————<br>小爱的主意是：</p>
<p><strong>ROLL : 1d10</strong>=d10(7)=<strong>7</strong></p>
<p>1-2 One piece！去孤儿院附近的山里寻宝！<br>3-4 去钓鱼吧，能不能钓上来宝藏？<br>5-6 研究转运仪式(福生玄黄…)<br>7-8 向路边的猫许愿(只是普通的猫吧！)<br>9 这里可以放个安价吗？尝试一下，中了的话没人就重新骰qwq<br>10 大成功/大失败</p>
<p><strong>ROLL : 1d2</strong>=d2(2)=<strong>2</strong></p>
<p>ps：发现好像不放图就不那么容易被吞的样子…呜呜呜我的立绘我的小表情 再想想有没有其他办法吧</p>
<p>“赚钱的话，怎么样比较快呢？没准再睡一觉醒来就成了巨~富有的远亲的继承人，也不是没有可能吧？”<br>小爱一边漫无目的地在街上瞎转，一边胡思乱想着。<br>“诶，这长得奇形怪状的猫哪来的？”<br>是一开始就在吗？一只黑猫呆呆地趴在路边。<br><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202306280134263.jpeg" alt="img"><br>“这种展开，是魔法少女吗？！“<br>思路总是如此跳跃的，小爱不知怎么想起了闲暇时在小书店偷偷翻看过的魔法少女漫画。<br>”是吧是吧绝对是吧！总之先许愿再说！“<br>可能黑猫也被吓住了吧，竟然没有跑开，怔怔的看着小爱跑过来，蹲下，闪着星光的紫瞳和一对黑瞳大眼瞪小眼<br>”我想要花不完的钱！呃…也别太显眼了。孤儿院也修成豪华别墅！啊还有…”</p>
<p>发生了什么：</p>
<p><strong>ROLL : 1d10</strong>=d10(7)=<strong>7</strong></p>
<p>1-5 喵？喵？喵？(你在说什么我听不懂因为我只是只普通猫咪)<br>6-9 吓跑了(不给我吃的还冲我吼 喵！)<br>10 真不是平常猫？</p>
<p>加班（哭） 只能稍微更一点了</p>
<p><strong>话还没说完，黑猫就一溜烟跑不见了<br>虽然很遗憾，猫只是普通的猫而已。<br>不甘心的小爱朝着消失的方向一顿狂奔，理所当然地一无所获。</strong></p>
<p><img src="https://gululu-default.obs.cn-north-4.myhuaweicloud.com/2023-06-29/2cfe6338-1d38-48f1-9e64-f0026e0c5535.png" alt="00142-77213927.png" style="zoom:25%;" /></p>
<p><strong>“什么嘛，果然漫画里都是骗人的”</strong><br>小爱的失望：</p>
<p><strong>ROLL : 1d100</strong>=d100(14)=<strong>14</strong></p>
<p><strong>这不是一点也不失望么！你还有点常识啊
</strong></p>
<p><img src="https://gululu-default.obs.cn-north-4.myhuaweicloud.com/2023-06-29/1ed14888-c5b3-46e0-902a-f1deb52b4caf.png" alt="00140-1819914487.png" style="zoom:25%;" /></p>
<p><strong>”事情总不会有这么容易啦…再想想办法吧“<br>一边努力把自己的思维切回正轨，小爱忽然发现</strong></p>
<p><strong>ROLL : 1d10</strong>=d10(4)=<strong>4</strong></p>
<p>1-3 跑太远没看路，迷路啦<br>4-6 闯入了电视剧的外景拍摄现场<br>7-9 某个著名偶像团体在开live(为什么会在这种乡下啊喂！)<br>10 大成功/大失败</p>
<p><strong>ROLL : 1d2</strong>=d2(1)=<strong>1</strong></p>
]]></content>
      <tags>
        <tag>其他</tag>
      </tags>
  </entry>
  <entry>
    <title>桌面贴片机调机日志</title>
    <url>/2025/03/21/%E6%A1%8C%E9%9D%A2%E8%B4%B4%E7%89%87%E6%9C%BA%E8%B0%83%E6%9C%BA%E6%97%A5%E5%BF%97/</url>
    <content><![CDATA[<p>因为有些样板和小批量的需求，jlc的smt又很贵，寻思着搞个家里桌面级能放下的小贴片机</p>
<p>这玩意做的人也不少了，openpnp系的各种diy机器，正邦的机器，还有量子猫系列的机器</p>
<p>研究了一阵，排除掉太大放不在家里的产线机，最好的肯定是量子猫的桌面机，但是玩意2w块不说，主要是他300多斤的重量…我哭死，这根本没法上楼，遂放弃</p>
<p>然后就是瀚海的diy机器，alan的机器，还有一些别的diy型号，算是各有优劣吧。</p>
<p>前两天刷咸鱼看到个出瀚海目前在售的那款v5pro的，飞达啥的配的比较全，机器也还算新，想了想先拿来玩玩也不错吧，于是入手。</p>
<p>昨天机器到了，so记录下调机过程，也算是留些参考。</p>
<span id="more"></span>
<h2 id="day1-开箱-校准-元件、封装和散料编带"><a href="#day1-开箱-校准-元件、封装和散料编带" class="headerlink" title="day1 开箱 校准 元件、封装和散料编带"></a>day1 开箱 校准 元件、封装和散料编带</h2><p><a href="https://www.yuque.com/u39182067/smtez">机器的教程主页</a></p>
<p>上来肯定是读文档</p>
<p>但是就和所有diy产品的通病一样，文档内容跳跃，充斥着过时软件内容，很多没有完成的地方，只能靠自己来对着软件摸索了…</p>
<p>还没开箱，先做点准备工作。</p>
<p>机器需要一台电脑做控制，好在usb口只要一个，翻出来个大学时候用的小新，4800u的cpu，大概也够用了吧。为了防止没事更新，格了重装了个win10的ltsc。</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503211309196.jpeg" alt="img"></p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503211309623.jpeg" alt="img"></p>
<p>因为这玩意长这样，所以还得配个桌子。</p>
<p>想来这东西高速启停振动不会小，为了防止影响精度或者桌面变成震楼机，干脆买个重型工作台（byd桌子比机器还沉）</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503211311032.jpeg" alt="img"></p>
<p>等待到货ing…先按下不表</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503212350214.jpeg" alt="img"></p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503212350821.jpeg" alt="img"></p>
<p><strong>开箱</strong></p>
<p>先放地上玩吧</p>
<p>接上气泵，电源，usb，开上位机，自动复位成功，吸嘴校准失败…</p>
<p>去找吸嘴页面手动校准下，还是失败</p>
<p>咋搞呢，想着估计是运输过程中有移位啥的原来的运动数据不准了吧，先做个校准试试吧</p>
<p>然后发现同步带松松的…按教程紧一紧，给线轨加点机油</p>
<p>结果坑爹了。皮带紧了之后振动变大了不少，无奈又松回去了=-=</p>
<p>去设置——校准页面按照校准向导做一遍（这个手册里也是过时的。。难绷）</p>
<p>麻烦的要死，盯吸嘴盯得眼睛都要花了</p>
<p>再校准下吸嘴，ok可以了，下一步</p>
<p><strong>元件和散料飞达</strong></p>
<p>想贴片一个器件需要两个玩意，元件和封装，都要和导入的pos位置文件里的对应名字匹配才行</p>
<p>先建立封装，这玩意不绑定具体物料（只确定外形和识别方式），软件里已经有常用的R0402，C0402之类的封装了，看了下也没啥要改的，先用着</p>
<p>ps：后面就发现坑了，默认的器件高度不对，电容普遍高一点，手动用游标卡尺测一下然后填进去，解决</p>
<p>然后建元件，元件是绑定对应的物料的，确定了料号和飞达位置、类型。</p>
<p>不想折腾电动飞达，先玩玩散料编带</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503212358172.jpeg" alt="img"></p>
<p>随便找条电容塞进去，磁吸贴在贴片机平台上</p>
<p>不是垂直平行的似乎也没关系，录入的时候会自动计算</p>
<p>ps：因为用的笔记本调机。懒得找软件界面了…凑合看吧</p>
<p>建一个元件，散料飞达，然后录入最顶端和最下面器件的中心位置，吸嘴碰到元件顶的高度，器件距离，就自动能算出有多少个料（不过反正写0也无所谓了，自己注意别用没了就行）</p>
<p>按下测试底部相机，看看识别是不是ok，他会吸一个料然后拍照识别一下再放回去</p>
<p>最后上个校准板试试，导入下资料里的校准板坐标文件，随便勾一个封装对应的料，手动改下元件名字和封装成刚才建的那个，就能关联上了（前面没有找不到元件报错了）</p>
<p>ps：这个批量操作默认就是开的…选择多个元件，然后改其中一个就会同步修改所有的。</p>
<p>然后校准板子，这个教程写的没啥毛病了，ok</p>
<p>试一下单个器件贴片，似乎运行是正常的，位置也没毛病。</p>
<p>机器有点吵，振动不小。睡觉，明天再说。</p>
<h2 id="day2-电动飞达，调校准板贴片"><a href="#day2-电动飞达，调校准板贴片" class="headerlink" title="day2 电动飞达，调校准板贴片"></a>day2 电动飞达，调校准板贴片</h2><p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503220005759.jpeg" alt="img"></p>
<p>桌子到了，上桌</p>
<p>ps：这桌子已经很厚重了，桌板有4cm，人坐上去都不晃，但是机器开起来依然会有振动…这玩意加速度惯量实在是太大了</p>
<p>pss：阳台实在是太晒了 遮光帘刻不容缓</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503220006600.jpeg" alt="img"></p>
<p>该鼓捣飞达了</p>
<p>这个飞达似乎和教程里的有一点点不一样，可能是改了版吧</p>
<p>把料带塞进去真的费劲，拿镊子把塑料带捅到压杆底下再掏出来…</p>
<p>这飞达贼响，齿轮噪声很大，或许该加油维护保养一下，之后再说吧</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503220008459.jpeg" alt="img"></p>
<p>供参考。感觉是这么上的没错。</p>
<p>然后录入元件。直接把顶部摄像头移到飞达上面二维码上然后点扫描录入就行了，自动填进去ID，倒是不用教程里那些写法</p>
<p>而且现在一个飞达可以写3个料进去了（三位8mm）</p>
<p>还是定位录入取料位置，填封装啊料距离啥的，测试视觉。</p>
<p>这有个问题，似乎三个料必须都填上，哪怕有空的…不然贴片时候报错。那就随便填个用不到的元件名占位得了，反正也不会被调用</p>
<p>搞定电动飞达，贴下校准板测试下，想着懒得用锡膏，抹了点焊油上去粘元件</p>
<p>结果又坑爹了，这破玩意不怎么粘不说，还贼难洗</p>
<p>无奈用洗板水洗掉然后手抹了点锡膏上去（工厂的常规做法其实是贴一层双面胶做测试…但是很难揭下来我也就算了不这么干了）</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503220013780.jpeg" alt="img"></p>
<p>贴成功了…但是…</p>
<p>看了下，飞达有概率会把器件振翻，仔细观察了下似乎料带在飞达里不是太紧会跳动，干脆卡一下</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503220015670.jpeg" alt="img"></p>
<p>这卡子不是特别合适，but it works</p>
<p>之后打印点合适的卡子</p>
<p>另外把吸取料的位置改到揭开塑料膜近端那边似乎也有改善</p>
<p>然后就是漫长的调机…总的来说基本上就是俩问题（0402问题比较大，0603没遇到啥问题）</p>
<p>1.吸取时候吸歪了，吸不上，视觉识别失败，抛料</p>
<p>2.往板子上贴的时候待不住，元件乱跑，立碑，贴下一个把上一个振飞了</p>
<p>第一个问题，怀疑过校准参数，比如一二相机和一二吸嘴的位置关系，重新校准过几遍，鼓捣了半天设置里的那些高级参数，还把校准玩烂了不得不重装软件从头来过…总之似乎没啥大用</p>
<p>后面发现似乎和吸嘴有关系，对于0402来说，CN065的吸嘴有点偏大了，CN040的会好很多，于是在封装里取消了0402对065吸嘴的使用</p>
<p>第二个问题…目前还没找到太好的解</p>
<p>一个原因是有时候板子高度设置不对，吸嘴下不到位，会有这种情况，校准板子时候给高度调低点有改善</p>
<p>另外因为手刷的锡膏，厚度不均匀，而且锡膏很容易干，干了又吸不住。。这可能也是个原因吧</p>
<p>懒得折腾了，明天再说。</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503220021350.jpeg" alt="img"></p>
<p>掉了一地元件（咸鱼买的炮灰贴片尾料，几块钱一盘，不用心疼）</p>
<p>issuelist：</p>
<ul>
<li>买几个新的吸嘴</li>
<li>维护飞达，加机油，把损坏位的电机换掉</li>
<li>贴一个刷好钢网锡膏的板子测试下看看</li>
</ul>
<h2 id="day3-修飞达-导入自己的板子测试-散料飞达-顶部视觉"><a href="#day3-修飞达-导入自己的板子测试-散料飞达-顶部视觉" class="headerlink" title="day3 修飞达 导入自己的板子测试 散料飞达 顶部视觉"></a>day3 修飞达 导入自己的板子测试 散料飞达 顶部视觉</h2><p>把飞达都挂在机器上测了下，发现有两位的尾部电机（拉塑料膜的电机）不动了（卖家提前说了，不过他没修）</p>
<p>拆开修下看看</p>
<p>结构很紧凑，拆着挺费劲的，挺巧妙的设计</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503230254499.jpeg" alt="img"></p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503230258337.jpeg" alt="img"></p>
<p>那个黄色的下面是一个微动，这是个很巧妙的压力传感器，用来实现编带的塑料膜的适当的张紧调节（可以对比下上面的安装料带之后的图）</p>
<p>真是巧妙的设计</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503230259247.jpeg" alt="img"></p>
<p>拆下坏掉的马达，N20减速电机</p>
<p>用电源测了下，坏掉的马达已经短路不转了。</p>
<p>用万用表测量，线圈电阻变成了0.5欧（短路），右边拿来替换的新电机大约是6欧</p>
<p>因为新电机没有这个蜗杆，只能费了半天劲把这个蜗杆抠下来，然后换到新电机上</p>
<p>然后重新焊回去，组装好（顺便给齿轮轴啥的上了点油，但是似乎没啥用），测试一下都可以正常动了</p>
<p>另一个坏掉的同样的办法修好</p>
<p>（吐槽下，这玩意原装的电机真的响的要死，特别大声，换了新电机的转起来动静就小很多。。不知道是不是用了劣质电机</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503230309836.jpeg" alt="img"></p>
<p>所有飞达都挂上，看起来拽拽的</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503230311180.jpeg" alt="img"></p>
<p>为了解决料跳飞的问题，建模画了个小卡子，3d打印了一些，效果不错，很完美</p>
<p>鼓捣完飞达该试试贴自己的板子了</p>
<p>我这边常用的eda软件是kicad，贴片机文档里只写了ad和立创eda的导出方法，但是又说支持ki</p>
<p>我自己看了下ki导出的csv格式和他要求的不太一样</p>
<p>不过抱着先试试再说的想法，直接导入了一下，竟然可以正常使用（喜</p>
<p>导出没啥特别的，选制造输出，csv，记得手动给板子左下角指定为贴片原点然后导出时候选上使用定位原点就行了</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503230314016.png" alt="image-20250323031406983"></p>
<p>因为我这个板子没有做mark点，就只能用手动校准了，文档写的比较清楚，不多说（其实也没麻烦多少，只贴一次的话，不过如果批量的话没mark点没法自动对位就麻烦了）</p>
<p>校准完了点几个元件看看定位位置没问题，ok</p>
<p>然后鼓捣下视觉散料飞达。毕竟没编带的芯片也不少，贴样板方便一些</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503230316203.jpeg" alt="img"></p>
<p>散料托盘，这玩意底部有个触点，必须挂在这个位置上，给里面的LED背光灯供电</p>
<p>一个格子只能放一种料</p>
<p>阻容的话比较简单，没有方向，建料也没啥特别的，就是要多一步测试下顶部视觉相机，然后选好元件轮廓就行了，因为没方向所以基本都能很轻松的识别也不用去改啥参数。<del>（但是真的会有人用视觉贴阻容吗。。何苦呢</del></p>
<p>芯片这玩意就坑爹了。</p>
<p>先说LQFP，这个STM32，我开始放了俩，一个拆板的，一个全新的，全新的还好，顶部底部都能正常识别，但是这个拆板的鼓捣了我半天…因为底部有一块助焊剂痕迹，底部相机死活识别不上，我还尝试了大元件模式，反向二值化乱七八糟各种设置试了个遍也不太行。</p>
<p>最后结论来看，至少有明显脏污的芯片可能还是不太适合吧。</p>
<p>另外因为stm32的pin1标识是一个挖洞的小圆点，在顶部视觉里选圆形pin1标识实测还是可以正常识别方向的，还算ok</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503230321542.jpeg" alt="img"></p>
<p>效果还挺不错的</p>
<p>然后更坑爹的就来了，这个sop8的运放的方向标是一个浅浅的激光打标的横杠，这玩意我尝试了里面所有的识别模式，都没法正常的识别出方向，那些模式文档里也没写怎么用，软件里也没有帮助（哭。。。）</p>
<p>包括器件本身的顶部和底部视觉也调了半天参数才能正常跑过封装测试（主要是调二值化）</p>
<p>严重怀疑是稳定性不足新加上的功能。反正试了一圈也没成功</p>
<p>结论就是<strong>pin1标识比较不明显的芯片，用视觉散料是不太现实</strong>…</p>
<p>可能最好的方法还是找一个空编带，把这些器件手动扔到编带里，用散料编带来贴吧，这样方向至少是不会错了</p>
<p>于是又折腾的有点晚了，今天还是没有成功贴片第一个板子呢…明天加油！越来越近了</p>
<p>todolist：</p>
<ul>
<li>贴片第一个板子</li>
<li>研究下自动换头</li>
</ul>
<h2 id="day4-上料，第一个板子"><a href="#day4-上料，第一个板子" class="headerlink" title="day4 上料，第一个板子"></a>day4 上料，第一个板子</h2><p>今天主要是上料</p>
<p>太折磨了</p>
<p>怪不得jlc要20的换料费</p>
<p>最理解产线辛苦的一集</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503240216079.jpeg" alt="img"></p>
<p>这个飞达也是无比的抽象，没事就振飞元件</p>
<p>有时候还会抽不动料带，从槽里划出去</p>
<p>折腾半天 感觉还是不能用垫片</p>
<p>垫片之后阻力太大，又容易飞</p>
<p>可能直接调上面的钢压片调低一点会好一些</p>
<p>还有个问题就是塑料膜的拉力，不同的料带还不太一样，这个也得调试</p>
<p>总之就是各种麻烦</p>
<p>再加上编带料和散料，大概贴了个板子</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503240218455.jpeg" alt="img"></p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503240218364.jpeg" alt="img"></p>
<p>效果还算ok吧</p>
<p>stm32贴歪了大概是因为吸嘴太细，旋转会吸不住（新吸嘴还没到）</p>
<p>整体都有点向右的偏移，可能是因为没有加mark点，刷了锡膏之后校准元件位置实在是不太准确。也有可能有一点偏移，需要做校准</p>
<p>明天再看看吧</p>
<p>折腾了四天，可算是贴出第一个板子了。。真不容易啊</p>
<p>看看这些上料掉出来的垃圾</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503240221868.jpeg" alt="img"></p>
<h2 id="day5-调飞达，自动换头，偏移校准"><a href="#day5-调飞达，自动换头，偏移校准" class="headerlink" title="day5 调飞达，自动换头，偏移校准"></a>day5 调飞达，自动换头，偏移校准</h2><p>到今天其实就没啥内容了</p>
<p>可能之后也没啥要写的了吧</p>
<p>首先是飞达跳料的问题，解决方法出人意料的简单，就给上面的压片手动往下掰一掰，让他适当的压紧就ok了</p>
<p>就是这个程度需要掌握一下</p>
<p>然后新买的吸嘴终于到了 狗屎申通，是真的慢</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503250222450.jpeg" alt="img"></p>
<p>自动换嘴设置没啥可说的，挺简单的按着文档就行</p>
<p>唯一的问题是，不同厂家的吸嘴高度其实是不一样的（摔</p>
<p>所以用原装带的吸嘴设定的高度，换了这家新买的吸嘴是不能用的（同一家不同型号的吸嘴高度倒是还算差不多吧。。）</p>
<p>咋说呢。。最好用同一批吧</p>
<p>然后可能同一个元件用同一个吸嘴校准，对应好，也有帮助吧</p>
<p>记得重新做一下吸嘴平衡校准</p>
<p>最后就是坑爹的偏移问题</p>
<p>也是鼓捣了好久</p>
<p>挺微妙的，至少看起来定位是不偏的，或许是板子两点校准的偏移？还是因为我没用mark点？</p>
<p>现在是干脆用了个板子偏移校准补偿了一下，倒是也不是不能用</p>
<p>之后有mark点了，多加几个mark点再尝试一下看看吧</p>
]]></content>
      <tags>
        <tag>硬件</tag>
      </tags>
  </entry>
  <entry>
    <title>测试文章</title>
    <url>/2022/02/17/%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0/</url>
    <content><![CDATA[<p>第一篇测试文章<br><img src="https://raw.githubusercontent.com/SuperHostPopo/MyIMG/main/img/202202172335325.jpg" alt=""></p>
<script type="math/tex; mode=display">S_n = \frac{1}{2}n(a_1 + a_n) = na_1 + \frac{n(n-1)}{2}d, n\in N^*</script><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line"></span><br><span class="line">rad=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000</span>):</span><br><span class="line">    rad.append(numpy.random.random()*<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">plt.hist(rad, bins=<span class="number">100</span>, color=<span class="string">&#x27;steelblue&#x27;</span>, normed=<span class="literal">True</span> )</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>测试</tag>
        <tag>网站</tag>
      </tags>
  </entry>
  <entry>
    <title>配置VSCode的Clangd语言服务支持STM32开发</title>
    <url>/2025/03/17/%E9%85%8D%E7%BD%AEVSCode%E7%9A%84Clangd%E8%AF%AD%E8%A8%80%E6%9C%8D%E5%8A%A1%E6%94%AF%E6%8C%81STM32%E5%BC%80%E5%8F%91/</url>
    <content><![CDATA[<p>众所周知STM32开发一般使用Keil或者CubeIDE来管理工程和编译，但是这俩玩意的编辑器都不太现代化，用起来不太爽，所以也有很多人用VSCode来编写代码，只使用IDE来进行编译和调试（当然也有使用VSCode+全套开源工具链打包进行编写+编译+调试的，但是在win下实现起来尤为的不方便以前尝试过这里先按下不表）</p>
<p>然而vsc虽然很好用，但是他默认的C/C++插件功能就很难说是强大了，自动补全和语法检查经常傻傻的。一直也就这么凑合着用下来，今天一不小心给vsc的补全又玩炸了，调配置的时候突然想起这事，于是去搜了一下，说vsc其实是可以支持强大的clangd语言服务的…</p>
<p>谁想到这就是坠入大坑的开始…</p>
<span id="more"></span>
<p>懒得多介绍了，网上一堆，简单说clangd应该是通用的最强大的C/C++语言服务（有没有之一？）</p>
<p>性能和特性都比vsc默认的微软工具强很多</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503172321392.png" alt="image-20250317232135358"></p>
<p>安装clangd其实很简单，在拓展商店里直接装就行了，他还会提醒你本地没有语言服务，选择自动安装就可以给你配好了，没啥难度</p>
<p>然后按照网上的教程配置clangd的特性</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503172328540.png" alt="image-20250317232844513"></p>
<p>打开vsc的配置json</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;C_Cpp.errorSquiggles&quot;: &quot;disabled&quot;,</span><br><span class="line">&quot;C_Cpp.intelliSenseEngineFallback&quot;: &quot;Disabled&quot;,</span><br><span class="line">&quot;C_Cpp.intelliSenseEngine&quot;: &quot;disabled&quot;,</span><br><span class="line">&quot;C_Cpp.autocomplete&quot;: &quot;disabled&quot;, // So you don&#x27;t get autocomplete from both extensions.</span><br></pre></td></tr></table></figure>
<p>这些代码用来禁用原来的拓展的语言服务，防止冲突。</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503172330675.png" alt="image-20250317233034654"></p>
<p>clangd路径已经被自动配置好了</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;clangd.arguments&quot;: [</span><br><span class="line">// 让 Clangd 生成更详细的日志</span><br><span class="line">&quot;--log=verbose&quot;,</span><br><span class="line">// 输出的 JSON 文件更美观</span><br><span class="line">&quot;--pretty&quot;,</span><br><span class="line">// 全局补全(输入时弹出的建议将会提供 CMakeLists.txt 里配置的所有文件中可能的符号，会自动补充头文件)</span><br><span class="line">&quot;--all-scopes-completion&quot;,</span><br><span class="line">// 建议风格：打包(重载函数只会给出一个建议）</span><br><span class="line">// 相反可以设置为detailed</span><br><span class="line">&quot;--completion-style=bundled&quot;,</span><br><span class="line">// 跨文件重命名变量</span><br><span class="line">&quot;--cross-file-rename&quot;,</span><br><span class="line">// 允许补充头文件</span><br><span class="line">&quot;--header-insertion=iwyu&quot;,</span><br><span class="line">// 输入建议中，已包含头文件的项与还未包含头文件的项会以圆点加以区分</span><br><span class="line">&quot;--header-insertion-decorators&quot;,</span><br><span class="line">// 在后台自动分析文件(基于 complie_commands，我们用CMake生成)</span><br><span class="line">&quot;--background-index&quot;,</span><br><span class="line">// 启用 Clang-Tidy 以提供「静态检查」</span><br><span class="line">&quot;--clang-tidy&quot;,</span><br><span class="line">// Clang-Tidy 静态检查的参数，指出按照哪些规则进行静态检查，详情见「与按照官方文档配置好的 VSCode 相比拥有的优势」</span><br><span class="line">// 参数后部分的*表示通配符</span><br><span class="line">// 在参数前加入-，如-modernize-use-trailing-return-type，将会禁用某一规则</span><br><span class="line">&quot;--clang-tidy-checks=cppcoreguidelines-*,performance-*,bugprone-*,portability-*,modernize-*,google-*&quot;,</span><br><span class="line">// 默认格式化风格: 谷歌开源项目代码指南</span><br><span class="line">// &quot;--fallback-style=file&quot;,</span><br><span class="line">// 同时开启的任务数量</span><br><span class="line">&quot;-j=2&quot;,</span><br><span class="line">// pch优化的位置(memory 或 disk，选择memory会增加内存开销，但会提升性能) 推荐在板子上使用disk</span><br><span class="line">&quot;--pch-storage=memory&quot;,</span><br><span class="line">// 启用这项时，补全函数时，将会给参数提供占位符，键入后按 Tab 可以切换到下一占位符，乃至函数末</span><br><span class="line">// 我选择禁用</span><br><span class="line">&quot;--function-arg-placeholders=false&quot;,</span><br><span class="line">// compelie_commands.json 文件的目录位置(相对于工作区，由于 CMake 生成的该文件默认在 build 文件夹中，故设置为 build)</span><br><span class="line">&quot;--compile-commands-dir=build&quot;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>加入这一坨clangd的特性配置</p>
<p>好了，搞定，看起来不难是吧…</p>
<p>但是你用这个配置打开一个工程目录…</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503172344994.png" alt="image-20250317234441904"></p>
<p>满眼一片红啊，啥都认不出来</p>
<p>原因也很简单，就是clangd没法正确检索工程的库文件。</p>
<p>vsc默认的C插件也有这个问题，所以一般会让你改成tag praser，然后就好了（</p>
<p>但是在clangd这里，坑就深了…</p>
<p>真正的折磨才刚刚开始</p>
<p>查阅资料发现，这玩意必须依赖一个叫做compile_commands.json的文件，里面记录了工程的目录结构，引用的库文件等，clangd依赖他来提供语言服务</p>
<p>这玩意咋生成呢？如果你的项目用的是cmake，那一切都很美好，</p>
<p><code>cmake -DCMAKE_EXPORT_COMPILE_COMMANDS=1</code></p>
<p>用这句就行了</p>
<p>然而很显然不管是keil还是cubeide用的都不是cmake（哭</p>
<p>keil是自己的编译器和管理方式，cubeide用的是make和makefile</p>
<p>那么这里有两个办法</p>
<h2 id="如果你用的是keil"><a href="#如果你用的是keil" class="headerlink" title="如果你用的是keil"></a>如果你用的是keil</h2><p>装一坨叫做arm keil studio pack的玩意</p>
<p>里面提供了一个插件可以直接导入keil的uvprojx文件，然后自动生成clangd所需的compile_commands.json文件</p>
<p>其实因为keil设计的这套方案本来就是配合的clangd语言服务嘛，自然给你都解决好了</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503172350650.png" alt="image-20250317235020611"></p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503172355766.png" alt="image-20250317235556732"></p>
<p>看起来一切都很美好，没毛病，除了这坨插件有点臃肿之外</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503172358312.png" alt="image-20250317235820190"></p>
<h2 id="但是如果你用的是CubeIDE…"><a href="#但是如果你用的是CubeIDE…" class="headerlink" title="但是如果你用的是CubeIDE…"></a>但是如果你用的是CubeIDE…</h2><p>首先，我们需要从makefile手动生成compile_commands.json</p>
<p>搜到有一个工具，叫做bear，可以通过make来生成compile_commands.json</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503180005004.png" alt="image-20250318000509964"></p>
<p>但是很遗憾，这玩意只支持linux版本（</p>
<p>本来打算放弃了，但是又发现这玩意有个windows的替代品（from clangd官网）</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503180006545.png" alt="image-20250318000613523"></p>
<p>那么我们安装这个玩意</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503180006519.png" alt="image-20250318000630479"></p>
<p>在makefile的路径下面试一试</p>
<p><code>python -m compiledb make all</code></p>
<p>很遗憾呢，Windows下面没有make…CubeIDE自己的make和gcc啥的是封在他的安装路径里面的，外面也调用不到</p>
<p>那么我们装一个make（此处过程省略，总之不管你用mingw还是Chocolatey还是啥…反正确保make命令是可用的就行了</p>
<p>然后再试一下…</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503180017040.png" alt="image-20250318001737010"></p>
<p>似乎成功了是吧，然后也生成了对应的compile_commands.json文件</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503180017939.png" alt="image-20250318001758910"></p>
<p>当然，我们可以把命令改成</p>
<p><code>python -m compiledb -n make all</code></p>
<p>不执行实际的make动作，只进行配置文件输出，防止影响工程实际代码（毕竟你的path里不一定有正确的gcc，鬼知道编译出什么玩意来）</p>
<p>然后把compile_commands.json这玩意放到工程的根目录下面，用vsc打开…</p>
<p>大功告成了…吗？</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503180022868.png" alt="image-20250318002223851"></p>
<p>事情往往没那么简单。。还是有报错。。</p>
<p>只能继续搜索，问google，问大d老师</p>
<p>看起来是因为cubeide的gcc使用了一个自定义的编译参数，clangd并不认识这玩意…</p>
<p>解决方法嘛</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503180024351.png" alt="image-20250318002439292"></p>
<p>手动修改compile_commands.json文件，把”-fcyclomatic-complexity”,都替换成空行</p>
<p>然后重新打开</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503180027654.png" alt="image-20250318002716568"></p>
<p>好吧…终于，你成功了=-=</p>
<p>但是 我不知道 这一切值得吗…</p>
<h2 id="结"><a href="#结" class="headerlink" title="结"></a>结</h2><p>最终，我删掉了clangd，删掉了上面的那一大坨东西，重新把配置改回了C/C++插件…</p>
<p>可能唯一的意义就是，确实熟悉了一坨编译方法和Windows下配置环境的过程吧</p>
<p>谁知道呢</p>
<p>姑且放在这里吧，或者如果真的有人对这些闲的蛋疼的鼓捣有兴趣的话，可以来看看</p>
<p>以及，发现了一个项目可以自动把cubeide转成clangd的支持</p>
<p><a href="https://github.com/alex-schulster/stm_lsp_nvim">https://github.com/alex-schulster/stm_lsp_nvim</a></p>
<p>很不错，满足了我的一切想象，但是…这玩意依然只支持linux（摔</p>
<p><img src="https://popoimg.oss-cn-beijing.aliyuncs.com/img/202503180030564.png" alt="image-20250318003024543"></p>
]]></content>
      <tags>
        <tag>软件,嵌入式</tag>
      </tags>
  </entry>
</search>
